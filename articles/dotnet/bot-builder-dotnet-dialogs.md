---
title: Introducción a los diálogos | Microsoft Docs
description: Aprenda a usar diálogos en el SDK de Bot Builder para Node.js para modelar conversaciones y administrar el flujo de conversación.
author: RobStand
ms.author: kamrani
manager: kamrani
ms.topic: article
ms.prod: bot-framework
ms.date: 12/13/2017
monikerRange: azure-bot-service-3.0
ms.openlocfilehash: eb99be4699bba71a1fdc55bab19d035e4e31f536
ms.sourcegitcommit: 67445b42796d90661afc643c6bb6533e9a662cbc
ms.translationtype: HT
ms.contentlocale: es-ES
ms.lasthandoff: 08/06/2018
ms.locfileid: "39574561"
---
# <a name="dialogs-in-the-bot-builder-sdk-for-net"></a><span data-ttu-id="21a1c-103">Diálogos en el SDK de Bot Builder para .NET</span><span class="sxs-lookup"><span data-stu-id="21a1c-103">Dialogs in the Bot Builder SDK for .NET</span></span>

[!INCLUDE [pre-release-label](../includes/pre-release-label-v3.md)]

> [!div class="op_single_selector"]
> - [.NET](../dotnet/bot-builder-dotnet-dialogs.md)
> - [Node.js](../nodejs/bot-builder-nodejs-dialog-overview.md)

<span data-ttu-id="21a1c-106">Al crear un bot mediante el SDK de Bot Builder para .NET, puede usar diálogos para modelar una conversación y administrar el [flujo de conversación](../bot-service-design-conversation-flow.md).</span><span class="sxs-lookup"><span data-stu-id="21a1c-106">When you create a bot using the Bot Builder SDK for .NET, you can use dialogs to model a conversation and manage [conversation flow](../bot-service-design-conversation-flow.md).</span></span> <span data-ttu-id="21a1c-107">Cada cuadro de diálogo es una abstracción que encapsula su propio estado en una clase de C# que implementa `IDialog`.</span><span class="sxs-lookup"><span data-stu-id="21a1c-107">Each dialog is an abstraction that encapsulates its own state in a C# class that implements `IDialog`.</span></span> <span data-ttu-id="21a1c-108">Un diálogo puede estar formado por otros diálogos para maximizar la reutilización, y un contexto de diálogo mantiene la [pila de diálogos](../bot-service-design-conversation-flow.md#dialog-stack) que están activos en la conversación en cualquier momento dado.</span><span class="sxs-lookup"><span data-stu-id="21a1c-108">A dialog can be composed with other dialogs to maximize reuse, and a dialog context maintains the [stack of dialogs](../bot-service-design-conversation-flow.md#dialog-stack) that are active in the conversation at any point in time.</span></span> 

<span data-ttu-id="21a1c-109">Una conversación que consta de diálogos se puede transferir entre varios equipos, lo que permite escalar la implementación del bot.</span><span class="sxs-lookup"><span data-stu-id="21a1c-109">A conversation that comprises dialogs is portable across computers, which makes it possible for your bot implementation to scale.</span></span> <span data-ttu-id="21a1c-110">Cuando usa diálogos en el SDK de Bot Builder para. NET, el estado de la conversación (la pila de diálogos y el estado de cada diálogo de la pila) se almacena automáticamente en el almacenamiento de [datos de estado](bot-builder-dotnet-state.md) de su elección.</span><span class="sxs-lookup"><span data-stu-id="21a1c-110">When you use dialogs in the Bot Builder SDK for .NET, conversation state (the dialog stack and the state of each dialog in the stack) is automatically stored to your choice of [state data](bot-builder-dotnet-state.md) storage.</span></span> <span data-ttu-id="21a1c-111">Esto permite que el código de servicio del bot sea sin estado, de forma muy parecida a una aplicación web que no necesita almacenar el estado de sesión en la memoria del servidor web.</span><span class="sxs-lookup"><span data-stu-id="21a1c-111">This enables your bot's service code to be stateless, much like a web application that does not need to store session state in web server memory.</span></span> 

## <a name="echo-bot-example"></a><span data-ttu-id="21a1c-112">Ejemplo de repetición de bot</span><span class="sxs-lookup"><span data-stu-id="21a1c-112">Echo bot example</span></span>

<span data-ttu-id="21a1c-113">Considere este ejemplo de repetición de bot, que describe cómo cambiar el bot que se crea en el tutorial [Inicio rápido](bot-builder-dotnet-quickstart.md) para que use los diálogos para intercambiar mensajes con el usuario.</span><span class="sxs-lookup"><span data-stu-id="21a1c-113">Consider this echo bot example, which describes how to change the bot that's created in the [Quickstart](bot-builder-dotnet-quickstart.md) tutorial so that it uses dialogs to exchange messages with the user.</span></span>

> [!TIP]
> Para seguir este ejemplo, use las instrucciones del tutorial [Inicio rápido](bot-builder-dotnet-quickstart.md) para crear un bot y, a continuación, actualice su archivo **MessagesController.cs**, como se describe a continuación.

### <a name="messagescontrollercs"></a><span data-ttu-id="21a1c-115">MessagesController.cs</span><span class="sxs-lookup"><span data-stu-id="21a1c-115">MessagesController.cs</span></span> 

<span data-ttu-id="21a1c-116">En el SDK de Bot Builder para .NET, la biblioteca de [Builder][builderLibrary] le permite implementar diálogos.</span><span class="sxs-lookup"><span data-stu-id="21a1c-116">In the Bot Builder SDK for .NET, the [Builder][builderLibrary] library enables you to implement dialogs.</span></span> <span data-ttu-id="21a1c-117">Para acceder a las clases pertinentes, importe el espacio de nombres `Dialogs`.</span><span class="sxs-lookup"><span data-stu-id="21a1c-117">To access the relevant classes, import the `Dialogs` namespace.</span></span>

[!code-csharp[Using statement](../includes/code/dotnet-dialogs.cs#usingStatement)]

<span data-ttu-id="21a1c-118">A continuación, agregue esta clase `EchoDialog` a **MessagesController.cs** para representar la conversación.</span><span class="sxs-lookup"><span data-stu-id="21a1c-118">Next, add this `EchoDialog` class to **MessagesController.cs** to represent the conversation.</span></span> 

[!code-csharp[EchoDialog class](../includes/code/dotnet-dialogs.cs#echobot1)]

<span data-ttu-id="21a1c-119">Luego, escriba la clase `EchoDialog` en el método `Post` mediante una llamada al método `Conversation.SendAsync`.</span><span class="sxs-lookup"><span data-stu-id="21a1c-119">Then, wire the `EchoDialog` class to the `Post` method by calling the `Conversation.SendAsync` method.</span></span>

[!code-csharp[Post method](../includes/code/dotnet-dialogs.cs#echobot2)]

### <a name="implementation-details"></a><span data-ttu-id="21a1c-120">Detalles de la implementación</span><span class="sxs-lookup"><span data-stu-id="21a1c-120">Implementation details</span></span> 

<span data-ttu-id="21a1c-121">El método `Post` está marcado como `async` porque Bot Builder usa las funciones de C# para controlar la comunicación asincrónica.</span><span class="sxs-lookup"><span data-stu-id="21a1c-121">The `Post` method is marked `async` because Bot Builder uses the C# facilities for handling asynchronous communication.</span></span> <span data-ttu-id="21a1c-122">Devuelve un objeto `Task`, que representa la tarea que es responsable de enviar las respuestas al mensaje pasado.</span><span class="sxs-lookup"><span data-stu-id="21a1c-122">It returns a `Task` object, which represents the task that is responsible for sending replies to the passed-in message.</span></span> <span data-ttu-id="21a1c-123">Si se produce una excepción, el objeto `Task` que devuelve el método contendrá la información de la excepción.</span><span class="sxs-lookup"><span data-stu-id="21a1c-123">If there is an exception, the `Task` that is returned by the method will contain the exception information.</span></span> 

<span data-ttu-id="21a1c-124">El método `Conversation.SendAsync` es clave para implementar diálogos con el SDK de Bot Builder para. NET.</span><span class="sxs-lookup"><span data-stu-id="21a1c-124">The `Conversation.SendAsync` method is key to implementing dialogs with the Bot Builder SDK for .NET.</span></span> <span data-ttu-id="21a1c-125">Sigue el <a href="https://en.wikipedia.org/wiki/Dependency_inversion_principle" target="_blank">principio de inversión de dependencia</a> y lleva a cabo estos pasos:</span><span class="sxs-lookup"><span data-stu-id="21a1c-125">It follows the <a href="https://en.wikipedia.org/wiki/Dependency_inversion_principle" target="_blank">dependency inversion principle</a> and performs these steps:</span></span>

1. <span data-ttu-id="21a1c-126">Crea una instancia de los componentes necesarios.</span><span class="sxs-lookup"><span data-stu-id="21a1c-126">Instantiates the required components</span></span>  
2. <span data-ttu-id="21a1c-127">Deserializa el estado de conversación (la pila de diálogos y el estado de cada diálogo de la pila) `IBotDataStore`.</span><span class="sxs-lookup"><span data-stu-id="21a1c-127">Deserializes the conversation state (the dialog stack and the state of each dialog in the stack) from `IBotDataStore`</span></span>
3. <span data-ttu-id="21a1c-128">Reanuda el proceso de conversación donde el bot se suspendió y espera un mensaje.</span><span class="sxs-lookup"><span data-stu-id="21a1c-128">Resumes the conversation process where the bot suspended and waits for a message</span></span>
4. <span data-ttu-id="21a1c-129">Envía las respuestas.</span><span class="sxs-lookup"><span data-stu-id="21a1c-129">Sends the replies</span></span>
5. <span data-ttu-id="21a1c-130">Serializa el estado de conversación actualizado y lo guarda de nuevo en `IBotDataStore`.</span><span class="sxs-lookup"><span data-stu-id="21a1c-130">Serializes the updated conversation state and saves it back to `IBotDataStore`</span></span>

<span data-ttu-id="21a1c-131">Cuando la conversación se inicia por primera vez, el diálogo no contiene estado, por lo que `Conversation.SendAsync` construye `EchoDialog` y llama a su método `StartAsync`.</span><span class="sxs-lookup"><span data-stu-id="21a1c-131">When the conversation first starts, the dialog does not contain state, so `Conversation.SendAsync` constructs `EchoDialog` and calls its `StartAsync` method.</span></span> <span data-ttu-id="21a1c-132">El método `StartAsync` llama a `IDialogContext.Wait` con el delegado de continuación para especificar el método que se debe invocar cuando se recibe un mensaje nuevo (`MessageReceivedAsync`).</span><span class="sxs-lookup"><span data-stu-id="21a1c-132">The `StartAsync` method calls `IDialogContext.Wait` with the continuation delegate to specify the method that should be called when a new message is received (`MessageReceivedAsync`).</span></span> 

<span data-ttu-id="21a1c-133">El método `MessageReceivedAsync` espera un mensaje, envía una respuesta y espera el siguiente mensaje.</span><span class="sxs-lookup"><span data-stu-id="21a1c-133">The `MessageReceivedAsync` method waits for a message, posts a response, and waits for the next message.</span></span> <span data-ttu-id="21a1c-134">Cada vez que se llama a `IDialogContext.Wait`, el bot entra en un estado suspendido y se puede reiniciar en cualquier equipo que reciba el mensaje.</span><span class="sxs-lookup"><span data-stu-id="21a1c-134">Every time `IDialogContext.Wait` is called, the bot enters a suspended state and can be restarted on any computer that receives the message.</span></span> 

<span data-ttu-id="21a1c-135">Un bot que se crea mediante los ejemplos de código anteriores responderá a cada mensaje que el usuario envía devolviendo simplemente el mensaje del usuario con el texto delante "Dijo: ".</span><span class="sxs-lookup"><span data-stu-id="21a1c-135">A bot that's created by using the code samples above will reply to each message that the user sends by simply echoing back the user's message prefixed with the text 'You said: '.</span></span> <span data-ttu-id="21a1c-136">Como el bot se crea mediante diálogos, puede evolucionar para admitir conversaciones más complejas sin tener que administrar explícitamente el estado.</span><span class="sxs-lookup"><span data-stu-id="21a1c-136">Because the bot is created using dialogs, it can evolve to support more complex conversations without having to explicitly manage state.</span></span>

## <a name="echo-bot-with-state-example"></a><span data-ttu-id="21a1c-137">Ejemplo de repetición de bot con estado</span><span class="sxs-lookup"><span data-stu-id="21a1c-137">Echo bot with state example</span></span>

<span data-ttu-id="21a1c-138">El ejemplo siguiente se basa en el anterior y se agrega la posibilidad de realizar el seguimiento del estado de los diálogos.</span><span class="sxs-lookup"><span data-stu-id="21a1c-138">This next example builds upon the one above by adding the ability to track dialog state.</span></span> <span data-ttu-id="21a1c-139">Cuando se actualiza la clase `EchoDialog`, como se muestra en el ejemplo de código anterior, el bot responderá a cada mensaje que envía el usuario devolviéndolo con un número delante (`count`) seguido del texto "Dijo: ".</span><span class="sxs-lookup"><span data-stu-id="21a1c-139">When the `EchoDialog` class is updated as shown in the code sample below, the bot will reply to each message that the user sends by echoing back the user's message prefixed with a number (`count`) followed by the text 'You said: '.</span></span> <span data-ttu-id="21a1c-140">El bot sigue aumentando `count` con cada respuesta, hasta que el usuario elige restablecer el recuento.</span><span class="sxs-lookup"><span data-stu-id="21a1c-140">The bot will continue to increment `count` with each reply, until the user elects to reset the count.</span></span>

### <a name="messagescontrollercs"></a><span data-ttu-id="21a1c-141">MessagesController.cs</span><span class="sxs-lookup"><span data-stu-id="21a1c-141">MessagesController.cs</span></span> 

[!code-csharp[EchoDialog class](../includes/code/dotnet-dialogs.cs#echobot3)]

### <a name="implementation-details"></a><span data-ttu-id="21a1c-142">Detalles de la implementación</span><span class="sxs-lookup"><span data-stu-id="21a1c-142">Implementation details</span></span>

<span data-ttu-id="21a1c-143">Como en el primer ejemplo, se llama al método `MessageReceivedAsync` cuando se recibe un nuevo mensaje.</span><span class="sxs-lookup"><span data-stu-id="21a1c-143">As in the first example, the `MessageReceivedAsync` method is called when a new message is received.</span></span> <span data-ttu-id="21a1c-144">Sin embargo, esta vez el método `MessageReceivedAsync` evalúa el mensaje del usuario antes de responder.</span><span class="sxs-lookup"><span data-stu-id="21a1c-144">This time though, the `MessageReceivedAsync` method evaluates the user's message before responding.</span></span> <span data-ttu-id="21a1c-145">Si el mensaje del usuario es "restablecer", el mensaje integrado `PromptDialog.Confirm` genera un diálogo secundario que pide al usuario que confirme el restablecimiento del recuento.</span><span class="sxs-lookup"><span data-stu-id="21a1c-145">If the user's message is "reset", the built-in `PromptDialog.Confirm` prompt spawns a sub-dialog that asks the user to confirm the count reset.</span></span> <span data-ttu-id="21a1c-146">El diálogo secundario tiene su propio estado privado que no interfiere con el estado del diálogo principal.</span><span class="sxs-lookup"><span data-stu-id="21a1c-146">The sub-dialog has its own private state that does not interfere with the parent dialog's state.</span></span> <span data-ttu-id="21a1c-147">Cuando el usuario responde al mensaje, el resultado del diálogo secundario se pasa al método `AfterResetAsync`, que envía un mensaje al usuario para indicar si se restableció o no el recuento y, a continuación, llama a `IDialogContext.Wait` con una continuación de vuelta a `MessageReceivedAsync` en el siguiente mensaje.</span><span class="sxs-lookup"><span data-stu-id="21a1c-147">When the user responds to the prompt, the result of the sub-dialog is passed to the `AfterResetAsync` method, which sends a message to the user to indicate whether or not the count was reset and then calls `IDialogContext.Wait` with a continuation back to `MessageReceivedAsync` on the next message.</span></span>

## <a name="dialog-context"></a><span data-ttu-id="21a1c-148">Contexto del diálogo</span><span class="sxs-lookup"><span data-stu-id="21a1c-148">Dialog context</span></span>

<span data-ttu-id="21a1c-149">La interfaz `IDialogContext` que se pasa a cada método de diálogo proporciona acceso a los servicios que necesita un diálogo para guardar el estado y comunicarse con el canal.</span><span class="sxs-lookup"><span data-stu-id="21a1c-149">The `IDialogContext` interface that is passed into each dialog method provides access to the services that a dialog requires to save state and communicate with the channel.</span></span> <span data-ttu-id="21a1c-150">La interfaz `IDialogContext` consta de tres interfaces: [Internals.IBotData][iBotData], [Internals.IBotToUser][iBotToUser] e [Internals.IDialogStack][iDialogStack].</span><span class="sxs-lookup"><span data-stu-id="21a1c-150">The `IDialogContext` interface comprises three interfaces: [Internals.IBotData][iBotData], [Internals.IBotToUser][iBotToUser], and [Internals.IDialogStack][iDialogStack].</span></span> 

### <a name="internalsibotdata"></a><span data-ttu-id="21a1c-151">Internals.IBotData</span><span class="sxs-lookup"><span data-stu-id="21a1c-151">Internals.IBotData</span></span>

<span data-ttu-id="21a1c-152">La interfaz `Internals.IBotData` proporciona acceso a los datos de estado por usuario, por conversación y de conversación privada que mantiene Connector.</span><span class="sxs-lookup"><span data-stu-id="21a1c-152">The `Internals.IBotData` interface provides access to the per-user, per-conversation, and private conversation state data that's maintained by Connector.</span></span> <span data-ttu-id="21a1c-153">Los datos de estado por usuario son útiles para almacenar datos de usuario que no están relacionados con una conversación específica, mientras que los datos por conversación resultan de utilidad para almacenar datos generales sobre una conversación; los datos de conversación privada son útiles para almacenar datos de usuario relacionados con una conversación en particular.</span><span class="sxs-lookup"><span data-stu-id="21a1c-153">Per-user state data is useful for storing user data that is not related to a specific conversation, while per-conversation data is useful for storing general data about a conversation, and private conversation data is useful for storing user data that is related to a specific conversation.</span></span> 

### <a name="internalsibottouser"></a><span data-ttu-id="21a1c-154">Internals.IBotToUser</span><span class="sxs-lookup"><span data-stu-id="21a1c-154">Internals.IBotToUser</span></span>

<span data-ttu-id="21a1c-155">`Internals.IBotToUser` proporciona métodos para enviar un mensaje del bot al usuario.</span><span class="sxs-lookup"><span data-stu-id="21a1c-155">`Internals.IBotToUser` provides methods to send a message from bot to user.</span></span> <span data-ttu-id="21a1c-156">Se pueden enviar mensajes en línea con la respuesta a la llamada del método de API web o directamente mediante el [cliente de Connector](bot-builder-dotnet-connector.md#create-a-connector-client).</span><span class="sxs-lookup"><span data-stu-id="21a1c-156">Messages may be sent inline with the response to the web API method call or directly by using the [Connector client](bot-builder-dotnet-connector.md#create-a-connector-client).</span></span> <span data-ttu-id="21a1c-157">Al enviar y recibir mensajes mediante el contexto del diálogo se garantiza que el estado `Internals.IBotData` se pasa a través de Connector.</span><span class="sxs-lookup"><span data-stu-id="21a1c-157">Sending and receiving messages through the dialog context ensures that the `Internals.IBotData` state is passed through the Connector.</span></span>

### <a name="internalsidialogstack"></a><span data-ttu-id="21a1c-158">Internals.IDialogStack</span><span class="sxs-lookup"><span data-stu-id="21a1c-158">Internals.IDialogStack</span></span>

<span data-ttu-id="21a1c-159">`Internals.IDialogStack` proporciona métodos para administrar la [pila de diálogos](../bot-service-design-conversation-flow.md#dialog-stack).</span><span class="sxs-lookup"><span data-stu-id="21a1c-159">`Internals.IDialogStack` provides methods to manage the [dialog stack](../bot-service-design-conversation-flow.md#dialog-stack).</span></span> <span data-ttu-id="21a1c-160">La mayor parte del tiempo, la pila de diálogos se administrará automáticamente.</span><span class="sxs-lookup"><span data-stu-id="21a1c-160">Most of the time, the dialog stack will automatically be managed for you.</span></span> <span data-ttu-id="21a1c-161">Sin embargo, puede haber casos donde desee administrar explícitamente la pila.</span><span class="sxs-lookup"><span data-stu-id="21a1c-161">However, there may be cases where you want to explictly manage the stack.</span></span> <span data-ttu-id="21a1c-162">Por ejemplo, puede que quiera llamar a un diálogo secundario y agregarlo al principio de la pila de diálogos, marcar el diálogo actual como completo (y así quitarlo de la pila de diálogos y devolver el resultado al diálogo anterior en la pila), suspender el diálogo actual hasta que llegue un mensaje del usuario o incluso restablecer toda la pila de diálogos.</span><span class="sxs-lookup"><span data-stu-id="21a1c-162">For example, you might want to call a child dialog and add it to the top of the dialog stack, mark the current dialog as complete (thereby removing it from the dialog stack and returning the result to the prior dialog in the stack), suspend the current dialog until a message from the user arrives, or even reset the dialog stack altogether.</span></span>

## <a name="serialization"></a><span data-ttu-id="21a1c-163">Serialización</span><span class="sxs-lookup"><span data-stu-id="21a1c-163">Serialization</span></span>

<span data-ttu-id="21a1c-164">La pila de diálogos y el estado de todos los diálogos activos se serializan en [IBotDataBag][iBotDataBag] por usuario y por conversación.</span><span class="sxs-lookup"><span data-stu-id="21a1c-164">The dialog stack and the state of all active dialogs are serialized to the per-user, per-conversation [IBotDataBag][iBotDataBag].</span></span> <span data-ttu-id="21a1c-165">El blob serializado se conserva en los mensajes que el bot envía y recibe de [Connector](bot-builder-dotnet-concepts.md#connector).</span><span class="sxs-lookup"><span data-stu-id="21a1c-165">The serialized blob is persisted in the messages that the bot sends to and receives from the [Connector](bot-builder-dotnet-concepts.md#connector).</span></span> <span data-ttu-id="21a1c-166">Para serializar una clase `Dialog`, debe incluir el atributo `[Serializable]`.</span><span class="sxs-lookup"><span data-stu-id="21a1c-166">To be serialized, a `Dialog` class must include the `[Serializable]` attribute.</span></span> <span data-ttu-id="21a1c-167">Todas las implementaciones de `IDialog` de la biblioteca de [Builder][builderLibrary] están marcadas como serializables.</span><span class="sxs-lookup"><span data-stu-id="21a1c-167">All `IDialog` implementations in the [Builder][builderLibrary] library are marked as serializable.</span></span> 

<span data-ttu-id="21a1c-168">Los [métodos de cadena](#dialog-chains) proporcionan una interfaz fluida para los diálogos que se puede usar en la sintaxis de consulta LINQ.</span><span class="sxs-lookup"><span data-stu-id="21a1c-168">The [Chain methods](#dialog-chains) provide a fluent interface to dialogs that is usable in LINQ query syntax.</span></span> <span data-ttu-id="21a1c-169">La forma compilada de la sintaxis de consulta LINQ usa con frecuencia métodos anónimos.</span><span class="sxs-lookup"><span data-stu-id="21a1c-169">The compiled form of LINQ query syntax often uses anonymous methods.</span></span> <span data-ttu-id="21a1c-170">Si estos métodos anónimos no hacen referencia al entorno de variables locales, no tienen estado y son mínimamente serializables.</span><span class="sxs-lookup"><span data-stu-id="21a1c-170">If these anonymous methods do not reference the environment of local variables, then these anonymous methods have no state and are trivially serializable.</span></span> <span data-ttu-id="21a1c-171">Sin embargo, si el método anónimo captura cualquier variable local del entorno, el objeto de cierre resultante (generado por el compilador) no está marcado como serializable.</span><span class="sxs-lookup"><span data-stu-id="21a1c-171">However, if the anonymous method captures any local variable in the environment, the resulting closure object (generated by the compiler) is not marked as serializable.</span></span> <span data-ttu-id="21a1c-172">En esta situación, Bot Builder produce una excepción `ClosureCaptureException` para identificar el problema.</span><span class="sxs-lookup"><span data-stu-id="21a1c-172">In this situation, Bot Builder will throw a `ClosureCaptureException` to identify the issue.</span></span>

<span data-ttu-id="21a1c-173">Para usar la reflexión para serializar clases que no están marcadas como serializables, la biblioteca de Builder incluye una serialización suplente basada en la reflexión que se puede usar para registrarse con [Autofac][autofac].</span><span class="sxs-lookup"><span data-stu-id="21a1c-173">To use reflection to serialize classes that are not marked as serializable, the Builder library includes a reflection-based serialization surrogate that you can use to register with [Autofac][autofac].</span></span>

[!code-csharp[Serialization](../includes/code/dotnet-dialogs.cs#serialization)]

## <a id="dialog-chains"></a> <span data-ttu-id="21a1c-174">Cadenas de diálogos</span><span class="sxs-lookup"><span data-stu-id="21a1c-174">Dialog chains</span></span>

<span data-ttu-id="21a1c-175">Aunque puede administrar explícitamente la pila de diálogos activos mediante `IDialogStack.Call<R>` y `IDialogStack.Done<R>`, también puede administrarla implícitamente mediante estos métodos fluidos de [cadena][chain].</span><span class="sxs-lookup"><span data-stu-id="21a1c-175">While you can explicitly manage the stack of active dialogs by using `IDialogStack.Call<R>` and `IDialogStack.Done<R>`, you can also implicitly manage the stack of active dialogs by using these fluent [Chain][chain] methods.</span></span>


|           <span data-ttu-id="21a1c-176">Método</span><span class="sxs-lookup"><span data-stu-id="21a1c-176">Method</span></span>            |  <span data-ttu-id="21a1c-177">Escriba</span><span class="sxs-lookup"><span data-stu-id="21a1c-177">Type</span></span>   |                                 <span data-ttu-id="21a1c-178">Notas</span><span class="sxs-lookup"><span data-stu-id="21a1c-178">Notes</span></span>                                  |
|-----------------------------|---------|------------------------------------------------------------------------|
|     <span data-ttu-id="21a1c-179">Chain.Select<T, R></span><span class="sxs-lookup"><span data-stu-id="21a1c-179">Chain.Select<T, R></span></span>      |  <span data-ttu-id="21a1c-180">LINQ</span><span class="sxs-lookup"><span data-stu-id="21a1c-180">LINQ</span></span>   |           <span data-ttu-id="21a1c-181">Admite "select" y "let" en la sintaxis de consulta LINQ.</span><span class="sxs-lookup"><span data-stu-id="21a1c-181">Supports "select" and "let" in LINQ query syntax.</span></span>            |
|  <span data-ttu-id="21a1c-182">Chain.SelectMany<T, C, R></span><span class="sxs-lookup"><span data-stu-id="21a1c-182">Chain.SelectMany<T, C, R></span></span>  |  <span data-ttu-id="21a1c-183">LINQ</span><span class="sxs-lookup"><span data-stu-id="21a1c-183">LINQ</span></span>   |            <span data-ttu-id="21a1c-184">Admite sucesivos "from" en la sintaxis de consulta LINQ.</span><span class="sxs-lookup"><span data-stu-id="21a1c-184">Supports successive "from" in LINQ query syntax.</span></span>            |
|       <span data-ttu-id="21a1c-185">Chain.Where<T></span><span class="sxs-lookup"><span data-stu-id="21a1c-185">Chain.Where<T></span></span>        |  <span data-ttu-id="21a1c-186">LINQ</span><span class="sxs-lookup"><span data-stu-id="21a1c-186">LINQ</span></span>   |                 <span data-ttu-id="21a1c-187">Admite "where" en la sintaxis de consulta LINQ.</span><span class="sxs-lookup"><span data-stu-id="21a1c-187">Supports "where" in LINQ query syntax.</span></span>                 |
|        <span data-ttu-id="21a1c-188">Chain.From<T></span><span class="sxs-lookup"><span data-stu-id="21a1c-188">Chain.From<T></span></span>        | <span data-ttu-id="21a1c-189">Cadenas</span><span class="sxs-lookup"><span data-stu-id="21a1c-189">Chains</span></span>  |                <span data-ttu-id="21a1c-190">Crea una instancia de un diálogo.</span><span class="sxs-lookup"><span data-stu-id="21a1c-190">Instantiates a new instance of a dialog.</span></span>                |
|       <span data-ttu-id="21a1c-191">Chain.Return<T></span><span class="sxs-lookup"><span data-stu-id="21a1c-191">Chain.Return<T></span></span>       | <span data-ttu-id="21a1c-192">Cadenas</span><span class="sxs-lookup"><span data-stu-id="21a1c-192">Chains</span></span>  |                <span data-ttu-id="21a1c-193">Devuelve un valor constante en la cadena.</span><span class="sxs-lookup"><span data-stu-id="21a1c-193">Returns a constant value into the chain.</span></span>                |
|         <span data-ttu-id="21a1c-194">Chain.Do<T></span><span class="sxs-lookup"><span data-stu-id="21a1c-194">Chain.Do<T></span></span>         | <span data-ttu-id="21a1c-195">Cadenas</span><span class="sxs-lookup"><span data-stu-id="21a1c-195">Chains</span></span>  |               <span data-ttu-id="21a1c-196">Permite efectos secundarios dentro de la cadena.</span><span class="sxs-lookup"><span data-stu-id="21a1c-196">Allows for side-effects within the chain.</span></span>                |
|  <span data-ttu-id="21a1c-197">Chain.ContinueWith<T, R></span><span class="sxs-lookup"><span data-stu-id="21a1c-197">Chain.ContinueWith<T, R></span></span>   | <span data-ttu-id="21a1c-198">Cadenas</span><span class="sxs-lookup"><span data-stu-id="21a1c-198">Chains</span></span>  |                      <span data-ttu-id="21a1c-199">Encadenamiento simple de diálogos.</span><span class="sxs-lookup"><span data-stu-id="21a1c-199">Simple chaining of dialogs.</span></span>                       |
|       <span data-ttu-id="21a1c-200">Chain.Unwrap<T></span><span class="sxs-lookup"><span data-stu-id="21a1c-200">Chain.Unwrap<T></span></span>       | <span data-ttu-id="21a1c-201">Cadenas</span><span class="sxs-lookup"><span data-stu-id="21a1c-201">Chains</span></span>  |                  <span data-ttu-id="21a1c-202">Desempaqueta un diálogo anidado en un diálogo.</span><span class="sxs-lookup"><span data-stu-id="21a1c-202">Unwrap a dialog nested in a dialog.</span></span>                   |
| <span data-ttu-id="21a1c-203">Chain.DefaultIfException<T></span><span class="sxs-lookup"><span data-stu-id="21a1c-203">Chain.DefaultIfException<T></span></span> | <span data-ttu-id="21a1c-204">Cadenas</span><span class="sxs-lookup"><span data-stu-id="21a1c-204">Chains</span></span>  | <span data-ttu-id="21a1c-205">Acepta una excepción del resultado anterior y devuelve default(t).</span><span class="sxs-lookup"><span data-stu-id="21a1c-205">Swallows an exception from the previous result and returns default(T).</span></span> |
|        <span data-ttu-id="21a1c-206">Chain.Loop<T></span><span class="sxs-lookup"><span data-stu-id="21a1c-206">Chain.Loop<T></span></span>        | <span data-ttu-id="21a1c-207">Rama</span><span class="sxs-lookup"><span data-stu-id="21a1c-207">Branch</span></span>  |                   <span data-ttu-id="21a1c-208">Repite la cadena completa de diálogos.</span><span class="sxs-lookup"><span data-stu-id="21a1c-208">Loops the entire chain of dialogs.</span></span>                   |
|        <span data-ttu-id="21a1c-209">Chain.Fold<T></span><span class="sxs-lookup"><span data-stu-id="21a1c-209">Chain.Fold<T></span></span>        | <span data-ttu-id="21a1c-210">Rama</span><span class="sxs-lookup"><span data-stu-id="21a1c-210">Branch</span></span>  |   <span data-ttu-id="21a1c-211">Incluye los resultados de una enumeración de diálogos en un único resultado.</span><span class="sxs-lookup"><span data-stu-id="21a1c-211">Folds results from an enumeration of dialogs into a single result.</span></span>   |
|     <span data-ttu-id="21a1c-212">Chain.Switch<T, R></span><span class="sxs-lookup"><span data-stu-id="21a1c-212">Chain.Switch<T, R></span></span>      | <span data-ttu-id="21a1c-213">Rama</span><span class="sxs-lookup"><span data-stu-id="21a1c-213">Branch</span></span>  |            <span data-ttu-id="21a1c-214">Admite la bifurcación en diferentes cadenas de diálogos.</span><span class="sxs-lookup"><span data-stu-id="21a1c-214">Supports branching into different dialog chains.</span></span>            |
|     <span data-ttu-id="21a1c-215">Chain.PostToUser<T></span><span class="sxs-lookup"><span data-stu-id="21a1c-215">Chain.PostToUser<T></span></span>     | <span data-ttu-id="21a1c-216">Message</span><span class="sxs-lookup"><span data-stu-id="21a1c-216">Message</span></span> |                      <span data-ttu-id="21a1c-217">Envía un mensaje al usuario.</span><span class="sxs-lookup"><span data-stu-id="21a1c-217">Posts a message to the user.</span></span>                      |
|     <span data-ttu-id="21a1c-218">Chain.WaitToBot<T></span><span class="sxs-lookup"><span data-stu-id="21a1c-218">Chain.WaitToBot<T></span></span>      | <span data-ttu-id="21a1c-219">Message</span><span class="sxs-lookup"><span data-stu-id="21a1c-219">Message</span></span> |                    <span data-ttu-id="21a1c-220">Espera un mensaje al bot.</span><span class="sxs-lookup"><span data-stu-id="21a1c-220">Waits for a message to the bot.</span></span>                     |
|    <span data-ttu-id="21a1c-221">Chain.PostToChain<T></span><span class="sxs-lookup"><span data-stu-id="21a1c-221">Chain.PostToChain<T></span></span>     | <span data-ttu-id="21a1c-222">Message</span><span class="sxs-lookup"><span data-stu-id="21a1c-222">Message</span></span> |              <span data-ttu-id="21a1c-223">Inicia una cadena con un mensaje del usuario.</span><span class="sxs-lookup"><span data-stu-id="21a1c-223">Starts a chain with a message from the user.</span></span>              |

### <a name="examples"></a><span data-ttu-id="21a1c-224">Ejemplos</span><span class="sxs-lookup"><span data-stu-id="21a1c-224">Examples</span></span> 

<span data-ttu-id="21a1c-225">La sintaxis de consulta LINQ usa el método `Chain.Select<T, R>`.</span><span class="sxs-lookup"><span data-stu-id="21a1c-225">The LINQ query syntax uses the `Chain.Select<T, R>` method.</span></span>

[!code-csharp[Chain.Select](../includes/code/dotnet-dialogs.cs#chain1)]

<span data-ttu-id="21a1c-226">O el método `Chain.SelectMany<T, C, R>`.</span><span class="sxs-lookup"><span data-stu-id="21a1c-226">Or the `Chain.SelectMany<T, C, R>` method.</span></span>

[!code-csharp[Chain.SelectMany](../includes/code/dotnet-dialogs.cs#chain2)]

<span data-ttu-id="21a1c-227">Los métodos `Chain.PostToUser<T>` y `Chain.WaitToBot<T>` envían mensajes del bot al usuario y viceversa.</span><span class="sxs-lookup"><span data-stu-id="21a1c-227">The `Chain.PostToUser<T>` and `Chain.WaitToBot<T>` methods post messages from the bot to the user and vice versa.</span></span>

[!code-csharp[Chain.PostToUser](../includes/code/dotnet-dialogs.cs#chain3)]

<span data-ttu-id="21a1c-228">El método `Chain.Switch<T, R>` bifurca el flujo de diálogos de la conversación.</span><span class="sxs-lookup"><span data-stu-id="21a1c-228">The `Chain.Switch<T, R>` method branches the conversation dialog flow.</span></span>

[!code-csharp[Chain.Switch](../includes/code/dotnet-dialogs.cs#chain4)]

<span data-ttu-id="21a1c-229">Si `Chain.Switch<T, R>` devuelve un elemento `IDialog<IDialog<T>>` anidado, entonces el elemento `IDialog<T>` interno se puede desempaquetar con `Chain.Unwrap<T>`.</span><span class="sxs-lookup"><span data-stu-id="21a1c-229">If `Chain.Switch<T, R>` returns a nested `IDialog<IDialog<T>>`, then the inner `IDialog<T>` can be unwrapped with `Chain.Unwrap<T>`.</span></span> <span data-ttu-id="21a1c-230">Esto permite la bifurcación de conversaciones a diferentes rutas de acceso de diálogos encadenados, posiblemente con una longitud desigual.</span><span class="sxs-lookup"><span data-stu-id="21a1c-230">This allows branching conversations to different paths of chained dialogs, possibly of unequal length.</span></span> <span data-ttu-id="21a1c-231">Este es un ejemplo más completo de bifurcación de diálogos escritos en el estilo de cadena fluida con administración implícita de la pila.</span><span class="sxs-lookup"><span data-stu-id="21a1c-231">This example shows a more complete example of branching dialogs written in the fluent chain style with implicit stack management.</span></span>

[!code-csharp[Chain.Switch](../includes/code/dotnet-dialogs.cs#chain5)]

## <a name="next-steps"></a><span data-ttu-id="21a1c-232">Pasos siguientes</span><span class="sxs-lookup"><span data-stu-id="21a1c-232">Next steps</span></span>

<span data-ttu-id="21a1c-233">Los diálogos administran el flujo de conversación entre un bot y un usuario.</span><span class="sxs-lookup"><span data-stu-id="21a1c-233">Dialogs manage conversation flow between a bot and a user.</span></span> <span data-ttu-id="21a1c-234">Un diálogo define cómo interactuar con un usuario.</span><span class="sxs-lookup"><span data-stu-id="21a1c-234">A dialog defines how to interact with a user.</span></span> <span data-ttu-id="21a1c-235">Un bot puede usar muchos diálogos organizados en pilas para guiar la conversación con el usuario.</span><span class="sxs-lookup"><span data-stu-id="21a1c-235">A bot can use many dialogs organized in stacks to guide the conversation with the user.</span></span> <span data-ttu-id="21a1c-236">En la siguiente sección, vea cómo la pila de diálogos crece y decrece a medida que crea y descarta diálogos de la pila.</span><span class="sxs-lookup"><span data-stu-id="21a1c-236">In the next section, see how the dialog stack grows and shrinks as you create and dismiss dialogs in the stack.</span></span>

> [!div class="nextstepaction"]
> [Administración del flujo de conversación con diálogos](bot-builder-dotnet-manage-conversation-flow.md)


[builderLibrary]: /dotnet/api/microsoft.bot.builder.dialogs

[iBotData]: /dotnet/api/microsoft.bot.builder.dialogs.internals.ibotdata

[iBotToUser]: /dotnet/api/microsoft.bot.builder.dialogs.internals.ibottouser

[iDialogStack]: /dotnet/api/microsoft.bot.builder.dialogs.internals.idialogstack

[iBotDataBag]: /dotnet/api/microsoft.bot.builder.dialogs.ibotdatabag

[autofac]: /dotnet/api/microsoft.bot.builder.autofac.base

[chain]: /dotnet/api/microsoft.bot.builder.dialogs.chain
