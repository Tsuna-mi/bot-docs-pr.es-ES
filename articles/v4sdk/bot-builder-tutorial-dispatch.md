---
title: Uso de la herramienta de distribución para LUIS y QnA Maker | Microsoft Docs
description: Obtenga información sobre cómo usar LUIS y QnA Maker en su bot.
keywords: LUIS, QnA, herramienta de distribución, varios servicios
author: DeniseMak
ms.author: v-demak
manager: kamrani
ms.topic: article
ms.prod: bot-framework
ms.date: 04/25/2018
monikerRange: azure-bot-service-4.0
ms.openlocfilehash: 6294021355f82ff53a2ea99db4fb19f44cf13029
ms.sourcegitcommit: f95702d27abbd242c902eeb218d55a72df56ce56
ms.translationtype: HT
ms.contentlocale: es-ES
ms.lasthandoff: 07/19/2018
ms.locfileid: "39306484"
---
## <a name="integrate-multiple-luis-apps-and-qna-services-with-the-dispatch-tool"></a><span data-ttu-id="f5ca3-104">Integración de varias aplicaciones de LUIS y servicios QnA con la herramienta de distribución</span><span class="sxs-lookup"><span data-stu-id="f5ca3-104">Integrate multiple LUIS apps and QnA services with the Dispatch tool</span></span>

<span data-ttu-id="f5ca3-105">En este tutorial se muestra cómo usar un modelo de LUIS generado por la herramienta de distribución, a fin de integrar el bot con varias aplicaciones de Language Understanding (LUIS) y servicios QnA Maker.</span><span class="sxs-lookup"><span data-stu-id="f5ca3-105">This tutorial demonstrates how to use a LUIS model generated by the Dispatch tool, to integrate your bot with multiple Language Understanding (LUIS) apps and QnAMaker services.</span></span> 

<span data-ttu-id="f5ca3-106">Imagine que ha desarrollado los servicios siguientes y que quiere crear un bot que se integre con todos ellos.</span><span class="sxs-lookup"><span data-stu-id="f5ca3-106">Imagine you've developed the following services, and you want to create a bot that integrates with all of them.</span></span>

| <span data-ttu-id="f5ca3-107">Tipo de servicio</span><span class="sxs-lookup"><span data-stu-id="f5ca3-107">Service type</span></span> | <span data-ttu-id="f5ca3-108">NOMBRE</span><span class="sxs-lookup"><span data-stu-id="f5ca3-108">Name</span></span> | <span data-ttu-id="f5ca3-109">DESCRIPCIÓN</span><span class="sxs-lookup"><span data-stu-id="f5ca3-109">Description</span></span> |
|------|------|------|
| <span data-ttu-id="f5ca3-110">Aplicación de LUIS</span><span class="sxs-lookup"><span data-stu-id="f5ca3-110">LUIS app</span></span> | <span data-ttu-id="f5ca3-111">HomeAutomation</span><span class="sxs-lookup"><span data-stu-id="f5ca3-111">HomeAutomation</span></span> | <span data-ttu-id="f5ca3-112">Reconoce las intenciones HomeAutomation.TurnOn HomeAutomation.TurnOff y HomeAutomation.None.</span><span class="sxs-lookup"><span data-stu-id="f5ca3-112">Recognizes the HomeAutomation.TurnOn, HomeAutomation.TurnOff, and HomeAutomation.None intents.</span></span>|
| <span data-ttu-id="f5ca3-113">Aplicación de LUIS</span><span class="sxs-lookup"><span data-stu-id="f5ca3-113">LUIS app</span></span> | <span data-ttu-id="f5ca3-114">Tiempo</span><span class="sxs-lookup"><span data-stu-id="f5ca3-114">Weather</span></span> | <span data-ttu-id="f5ca3-115">Reconoce las intenciones Weather.GetForecast y Weather.GetCondition.</span><span class="sxs-lookup"><span data-stu-id="f5ca3-115">Recognizes the Weather.GetForecast and Weather.GetCondition intents.</span></span>|
| <span data-ttu-id="f5ca3-116">Servicio QnA Maker</span><span class="sxs-lookup"><span data-stu-id="f5ca3-116">QnAMaker service</span></span> | <span data-ttu-id="f5ca3-117">Preguntas más frecuentes</span><span class="sxs-lookup"><span data-stu-id="f5ca3-117">FAQ</span></span>  | <span data-ttu-id="f5ca3-118">Proporciona respuestas a preguntas sobre un sistema de iluminación de automatización del hogar</span><span class="sxs-lookup"><span data-stu-id="f5ca3-118">Provides answers to questions about a home automation lighting system</span></span> |

<span data-ttu-id="f5ca3-119">Primero vamos a crear las aplicaciones y los servicios y luego los integraremos.</span><span class="sxs-lookup"><span data-stu-id="f5ca3-119">Let's first create the apps and services, then integrate them together.</span></span>

> [!NOTE]
> <span data-ttu-id="f5ca3-120">Las tres aplicaciones deben crearse en la misma ubicación de Azure para que la herramienta de distribución acceda a ellas correctamente.</span><span class="sxs-lookup"><span data-stu-id="f5ca3-120">All three apps need to be created within the same Azure location for Dispatch to access them successfully.</span></span> <span data-ttu-id="f5ca3-121">En el siguiente ejemplo de código de distribución se usa la ubicación del Oeste de EE. UU.</span><span class="sxs-lookup"><span data-stu-id="f5ca3-121">Our example Dispatch code below uses the example location West US.</span></span>

## <a name="create-the-luis-apps"></a><span data-ttu-id="f5ca3-122">Crear las aplicaciones de LUIS</span><span class="sxs-lookup"><span data-stu-id="f5ca3-122">Create the LUIS apps</span></span>

<span data-ttu-id="f5ca3-123">La forma más rápida de crear las aplicaciones de LUIS HomeAutomation y Weather consiste en descargar los archivos [homeautomation.json][HomeAutomationJSON] y [weather.json][WeatherJSON].</span><span class="sxs-lookup"><span data-stu-id="f5ca3-123">The fastest way to create the HomeAutomation and Weather LUIS apps is to download the [homeautomation.json][HomeAutomationJSON] and [weather.json][WeatherJSON] files.</span></span> <span data-ttu-id="f5ca3-124">Después, vaya al [sitio web de LUIS](https://www.luis.ai/home) e inicie sesión.</span><span class="sxs-lookup"><span data-stu-id="f5ca3-124">Then go to the [LUIS website](https://www.luis.ai/home) and sign in.</span></span> <span data-ttu-id="f5ca3-125">Haga clic en **Mis aplicaciones** > **Import new app** (Importar nueva aplicación) y elija el archivo homeautomation.json.</span><span class="sxs-lookup"><span data-stu-id="f5ca3-125">Click on **My Apps** > **Import new app** and choose the homeautomation.json file.</span></span> <span data-ttu-id="f5ca3-126">Asigne el nombre `homeautomation` a la nueva aplicación.</span><span class="sxs-lookup"><span data-stu-id="f5ca3-126">Name the new app `homeautomation`.</span></span> <span data-ttu-id="f5ca3-127">Haga clic en **Mis aplicaciones** > **Import new app** (Importar nueva aplicación) y elija el archivo weather.json.</span><span class="sxs-lookup"><span data-stu-id="f5ca3-127">Click on **My Apps** > **Import new app** and choose the weather.json file.</span></span> <span data-ttu-id="f5ca3-128">Asigne el nombre `weather` a esta otra aplicación.</span><span class="sxs-lookup"><span data-stu-id="f5ca3-128">Name this other new app `weather`.</span></span>

## <a name="create-the-qna-cognitive-service-in-azure"></a><span data-ttu-id="f5ca3-129">Crear el servicio cognitivo de QnA en Azure</span><span class="sxs-lookup"><span data-stu-id="f5ca3-129">Create the QnA Cognitive Service in Azure</span></span>

<span data-ttu-id="f5ca3-130">Un servicio QnA Maker está formado por dos partes: el servicio cognitivo de Azure y la base de conocimiento de pares de preguntas y respuestas que se publica mediante el servicio cognitivo.</span><span class="sxs-lookup"><span data-stu-id="f5ca3-130">A QnA Maker service involves two parts, which are the Cognitive Service in Azure, and the knowledge base of Q&A pairs that you publish using the Cognitive Service.</span></span>

<span data-ttu-id="f5ca3-131">Para crear el servicio cognitivo en Azure, inicie sesión en Azure Portal en https://portal.azure.com y haga lo siguiente:</span><span class="sxs-lookup"><span data-stu-id="f5ca3-131">To create the Cognitive Service in Azure, log in to the Azure portal at https://portal.azure.com, and do the following:</span></span>

1. <span data-ttu-id="f5ca3-132">Haga clic en **Todos los servicios**.</span><span class="sxs-lookup"><span data-stu-id="f5ca3-132">Click **All services**.</span></span>
1. <span data-ttu-id="f5ca3-133">Busque en `Cognitive` y seleccione **Cognitive Services**.</span><span class="sxs-lookup"><span data-stu-id="f5ca3-133">Search on `Cognitive` and select **Cognitive Services**.</span></span>
1. <span data-ttu-id="f5ca3-134">Haga clic en **Agregar**.</span><span class="sxs-lookup"><span data-stu-id="f5ca3-134">Click **Add**.</span></span>
1. <span data-ttu-id="f5ca3-135">Busque en `QnA` y seleccione **QnA Maker**.</span><span class="sxs-lookup"><span data-stu-id="f5ca3-135">Search on `QnA` and select **QnA Maker**.</span></span>
1. <span data-ttu-id="f5ca3-136">En la hoja de QnA Maker, haga clic en **Crear**.</span><span class="sxs-lookup"><span data-stu-id="f5ca3-136">On the QnA Maker blade, click **Create**.</span></span>
1. <span data-ttu-id="f5ca3-137">Rellene la información y cree el servicio QnA Maker.</span><span class="sxs-lookup"><span data-stu-id="f5ca3-137">Fill in the information and create the QnA Maker service.</span></span>

    <!-- TODO: Add screenshot.-->

    * <span data-ttu-id="f5ca3-138">Escriba un nombre para el servicio.</span><span class="sxs-lookup"><span data-stu-id="f5ca3-138">Enter a name for the service.</span></span> <span data-ttu-id="f5ca3-139">Para este tutorial usaremos `SmartLightQnA`.</span><span class="sxs-lookup"><span data-stu-id="f5ca3-139">For this tutorial we'll use `SmartLightQnA`.</span></span>
    * <span data-ttu-id="f5ca3-140">Seleccione la suscripción que se va a usar.</span><span class="sxs-lookup"><span data-stu-id="f5ca3-140">Select the subscription to use.</span></span>
    * <span data-ttu-id="f5ca3-141">Seleccione el plan de tarifa que se va a usar. Ahora usaremos el plan F0 (gratis).</span><span class="sxs-lookup"><span data-stu-id="f5ca3-141">Select the management pricing tier to use; we'll use the F0 (free) tier.</span></span>
    * <span data-ttu-id="f5ca3-142">Cree el grupo de recursos que se va a usar o seleccione uno nuevo.</span><span class="sxs-lookup"><span data-stu-id="f5ca3-142">Create one, or select a new, resource group to use.</span></span> <span data-ttu-id="f5ca3-143">En este tutorial, vamos a crear el grupo de recursos `SmartLightQnA`.</span><span class="sxs-lookup"><span data-stu-id="f5ca3-143">For this tutorial we'll create a new `SmartLightQnA` resource group.</span></span>
    * <span data-ttu-id="f5ca3-144">Seleccione un plan de tarifa de búsqueda; aquí usaremos el plan B (básico).</span><span class="sxs-lookup"><span data-stu-id="f5ca3-144">Select a search pricing tier; we'll use the B (basic) tier.</span></span>
    * <span data-ttu-id="f5ca3-145">Seleccione una ubicación de búsqueda; aquí usaremos `West US`.</span><span class="sxs-lookup"><span data-stu-id="f5ca3-145">Select a search location; we'll use `West US`.</span></span>
    * <span data-ttu-id="f5ca3-146">Escriba el nombre que se usará para la aplicación; en este caso, mantendremos el valor predeterminado `SmartLightQnA`.</span><span class="sxs-lookup"><span data-stu-id="f5ca3-146">Enter an application name to use; we'll keep the default `SmartLightQnA`.</span></span>
    * <span data-ttu-id="f5ca3-147">Seleccione la ubicación del sitio web; aquí usaremos `West US`.</span><span class="sxs-lookup"><span data-stu-id="f5ca3-147">Select the website location; we'll use `West US`.</span></span>
    * <span data-ttu-id="f5ca3-148">Mantenga el valor predeterminado consistente en habilitar Application Insights.</span><span class="sxs-lookup"><span data-stu-id="f5ca3-148">Keep the default of enabling app insights.</span></span>
    * <span data-ttu-id="f5ca3-149">Seleccione una ubicación de Application Insights; aquí usaremos `West US 2`.</span><span class="sxs-lookup"><span data-stu-id="f5ca3-149">Select an app insights location; we'll use `West US 2`.</span></span>
    * <span data-ttu-id="f5ca3-150">Haga clic en **Crear** para crear el servicio QnA Maker.</span><span class="sxs-lookup"><span data-stu-id="f5ca3-150">Click **Create** to create your QnA Maker service.</span></span>
    * <span data-ttu-id="f5ca3-151">Azure crea y empieza a implementar el servicio.</span><span class="sxs-lookup"><span data-stu-id="f5ca3-151">Azure creates and begins to deploy your service.</span></span>

1. <span data-ttu-id="f5ca3-152">Una vez que se haya implementado, vea la notificación y haga clic en **Go to resource** (Ir al recurso) para ir a la hoja del servicio.</span><span class="sxs-lookup"><span data-stu-id="f5ca3-152">Once the service is deployed, view the notification and click **Go to resource** to navigate to the blade for the service.</span></span>
1. <span data-ttu-id="f5ca3-153">Haga clic en **Claves** para obtener las claves.</span><span class="sxs-lookup"><span data-stu-id="f5ca3-153">Click **Keys** to grab your keys.</span></span>

    * <span data-ttu-id="f5ca3-154">Copie el nombre del servicio y la primera clave.</span><span class="sxs-lookup"><span data-stu-id="f5ca3-154">Copy the name of the service and your first key.</span></span> <span data-ttu-id="f5ca3-155">Los necesitará en los pasos siguientes.</span><span class="sxs-lookup"><span data-stu-id="f5ca3-155">You will need these in following steps.</span></span>
    * <span data-ttu-id="f5ca3-156">Obtendrá dos claves para poder volver a generar una de ellas de cada vez sin tener que interrumpir el servicio.</span><span class="sxs-lookup"><span data-stu-id="f5ca3-156">You get two keys so that you can regenerate one of them at a time without having to interrupt your service.</span></span>

## <a name="create-and-publish-the-qna-maker-knowledge-base"></a><span data-ttu-id="f5ca3-157">Crear y publicar la base de conocimiento de QnA Maker</span><span class="sxs-lookup"><span data-stu-id="f5ca3-157">Create and publish the QnA Maker knowledge base</span></span>

<span data-ttu-id="f5ca3-158">Vaya al [sitio web de QnA Maker](https://qnamaker.ai) e inicie sesión.</span><span class="sxs-lookup"><span data-stu-id="f5ca3-158">Go to the [QnA Maker website](https://qnamaker.ai) and sign in.</span></span> <span data-ttu-id="f5ca3-159">Seleccione **Create a knowledge base** (Crear una base de conocimiento) y cree una base de conocimiento denominada "FAQ".</span><span class="sxs-lookup"><span data-stu-id="f5ca3-159">Select **Create a knowledge base** and create a new knowledge base named "FAQ".</span></span> <span data-ttu-id="f5ca3-160">Haga clic en el botón **Seleccionar archivo** y cargue el [archivo TSV de ejemplo][FAQ_TSV].</span><span class="sxs-lookup"><span data-stu-id="f5ca3-160">Click the **Select file** button and upload the [sample TSV file][FAQ_TSV].</span></span> <span data-ttu-id="f5ca3-161">Haga clic en **Crear** y, una vez que se haya creado el servicio, haga clic en **Publicar**.</span><span class="sxs-lookup"><span data-stu-id="f5ca3-161">Click **Create**, and once the service is created, click **Publish**.</span></span>

## <a name="use-the-dispatch-tool-to-create-the-dispatcher-luis-app"></a><span data-ttu-id="f5ca3-162">Usar la herramienta de distribución para crear la aplicación de LUIS de distribuidor</span><span class="sxs-lookup"><span data-stu-id="f5ca3-162">Use the Dispatch tool to create the dispatcher LUIS app</span></span>

<span data-ttu-id="f5ca3-163">Ahora, vamos a crear una aplicación de LUIS para combinar los servicios que hemos creado.</span><span class="sxs-lookup"><span data-stu-id="f5ca3-163">Next, let's create a LUIS app to combine each of the services we created.</span></span>

<span data-ttu-id="f5ca3-164">Instale la [herramienta de distribución][DispatchTool]. Para ello, ejecute este comando en un símbolo del sistema de Node.js.</span><span class="sxs-lookup"><span data-stu-id="f5ca3-164">Install the [Dispatch tool][DispatchTool] by running this command at a Node.js command prompt.</span></span>

```
npm install -g botdispatch
```

<span data-ttu-id="f5ca3-165">Ejecute el comando siguiente para inicializar la herramienta de distribución del nombre `CombineWeatherAndLights`.</span><span class="sxs-lookup"><span data-stu-id="f5ca3-165">Run the following command to initialize the Dispatch tool of the name `CombineWeatherAndLights`.</span></span> <span data-ttu-id="f5ca3-166">Sustituya su [clave de creación de LUIS](https://docs.microsoft.com/en-us/azure/cognitive-services/LUIS/luis-concept-keys) por `"YOUR-LUIS-AUTHORING-KEY"`.</span><span class="sxs-lookup"><span data-stu-id="f5ca3-166">Substitute your [LUIS authoring key](https://docs.microsoft.com/en-us/azure/cognitive-services/LUIS/luis-concept-keys) for `"YOUR-LUIS-AUTHORING-KEY"`.</span></span>

```
dispatch init -name CombineWeatherAndLights -luisAuthoringKey "YOUR-LUIS-AUTHORING-KEY" -luisAuthoringRegion westus
```

<span data-ttu-id="f5ca3-167">Para cada una de las aplicaciones de LUIS que ha creado, obtenga el identificador de aplicación de LUIS.</span><span class="sxs-lookup"><span data-stu-id="f5ca3-167">For each of the LUIS apps that you created, get the LUIS app ID.</span></span> <span data-ttu-id="f5ca3-168">Los encontrará para cada aplicación en **Mis aplicaciones**, en el [sitio de LUIS](https://www.luis.ai/home). Haga clic en el nombre de la aplicación y, luego, en **Configuración** para ver el identificador de aplicación.</span><span class="sxs-lookup"><span data-stu-id="f5ca3-168">Those can be found for each app under **My Apps** on the [LUIS site](https://www.luis.ai/home); click on the app name, and then click on **Settings** to see the Application ID.</span></span> 

<span data-ttu-id="f5ca3-169">Después, ejecute el comando `dispatch add` para cada una de las aplicaciones de LUIS que ha creado.</span><span class="sxs-lookup"><span data-stu-id="f5ca3-169">Then run the `dispatch add` command for each of the LUIS apps you created.</span></span>

```
dispatch add -type luis -id "HOMEAUTOMATION-APP-ID" -name homeautomation -version 0.1 -key "YOUR-LUIS-AUTHORING-KEY"
dispatch add -type luis -id "WEATHER-APP-ID" -name weather -version 0.1 -key "YOUR-LUIS-AUTHORING-KEY"

```

<span data-ttu-id="f5ca3-170">Ejecute el comando `dispatch add` para el servicio QnA Maker que ha creado.</span><span class="sxs-lookup"><span data-stu-id="f5ca3-170">Run the `dispatch add` command for the QnA Maker service you created.</span></span> <span data-ttu-id="f5ca3-171">El parámetro `-key` debería ser la clave de Azure Portal, que guardó al completar los pasos necesarios para [crear el servicio cognitivo de QnA en Azure](./bot-builder-tutorial-dispatch.md#create-the-qna-cognitive-service-in-azure).</span><span class="sxs-lookup"><span data-stu-id="f5ca3-171">The `-key` parameter should be the key from the Azure Portal, that you saved when you completed the steps to [Create the QnA Cognitive Service in Azure](./bot-builder-tutorial-dispatch.md#create-the-qna-cognitive-service-in-azure).</span></span>

```
dispatch add -type qna -id "QNA-KB-ID" -name faq -key "YOUR-QNA-SUBSCRIPTION-KEY"
```

<span data-ttu-id="f5ca3-172">Ejecute `dispatch create`:</span><span class="sxs-lookup"><span data-stu-id="f5ca3-172">Run `dispatch create`:</span></span>

```
dispatch create
```

<span data-ttu-id="f5ca3-173">De este modo se crea la aplicación de LUIS de distribuidor denominada **CombineWeatherAndLights**.</span><span class="sxs-lookup"><span data-stu-id="f5ca3-173">This creates the dispatcher LUIS app named **CombineWeatherAndLights**.</span></span> <span data-ttu-id="f5ca3-174">Puede ver la nueva aplicación en [https://www.luis.ai/home](https://www.luis.ai/home).</span><span class="sxs-lookup"><span data-stu-id="f5ca3-174">You can see the new app in [https://www.luis.ai/home](https://www.luis.ai/home).</span></span> 

![Aplicación de distribuidor en LUIS.ai](media/tutorial-dispatch/dispatch-app-in-luis.png)

<span data-ttu-id="f5ca3-176">Haga clic en la nueva aplicación.</span><span class="sxs-lookup"><span data-stu-id="f5ca3-176">Click on the new app.</span></span> <span data-ttu-id="f5ca3-177">En **Intenciones** puede ver tiene las intenciones `l_homeautomation`, `l_weather` y `q_faq`.</span><span class="sxs-lookup"><span data-stu-id="f5ca3-177">Under **Intents** you can see it has the `l_homeautomation`, `l_weather`, and `q_faq` intents.</span></span>

![Intenciones del distribuidor en LUIS.ai](media/tutorial-dispatch/dispatch-intents-in-luis.png)

<span data-ttu-id="f5ca3-179">Haga clic en el botón **Entrenar** para entrenar la aplicación de LUIS y use la pestaña **PUBLICAR** para [publicarla](https://docs.microsoft.com/en-us/azure/cognitive-services/LUIS/publishapp).</span><span class="sxs-lookup"><span data-stu-id="f5ca3-179">Click the **Train** button to train the LUIS app, and use the **PUBLISH** tab to [publish](https://docs.microsoft.com/en-us/azure/cognitive-services/LUIS/publishapp) it.</span></span> <span data-ttu-id="f5ca3-180">Haga clic en **Configuración** para copiar el identificador de la nueva aplicación y usarlo en su bot.</span><span class="sxs-lookup"><span data-stu-id="f5ca3-180">Click on **Settings** to copy the ID of the new app to use in your bot.</span></span>

## <a name="create-the-bot"></a><span data-ttu-id="f5ca3-181">Crear el bot</span><span class="sxs-lookup"><span data-stu-id="f5ca3-181">Create the bot</span></span>

<span data-ttu-id="f5ca3-182">Ahora puede enlazar las intenciones de la aplicación de distribuidor con la lógica de su bot, que enruta los mensajes al servicio QnA Maker y las aplicaciones de LUIS originales.</span><span class="sxs-lookup"><span data-stu-id="f5ca3-182">Now you can hook up the dispatcher app's intents to logic in your bot, which routes messages to the original LUIS apps and QnAMaker service.</span></span>

<span data-ttu-id="f5ca3-183">Puede usar como punto de partida el ejemplo que se incluye con Bot Builder SDK.</span><span class="sxs-lookup"><span data-stu-id="f5ca3-183">You can use the sample included with the Bot Builder SDK as a starting point.</span></span>

# <a name="ctabcsaddref"></a>[<span data-ttu-id="f5ca3-184">C#</span><span class="sxs-lookup"><span data-stu-id="f5ca3-184">C#</span></span>](#tab/csaddref)

<span data-ttu-id="f5ca3-185">Comience con el código del [ejemplo de distribución de LUIS][DispatchBotCS].</span><span class="sxs-lookup"><span data-stu-id="f5ca3-185">Start with the code in the [LUIS Dispatch sample][DispatchBotCS].</span></span> <span data-ttu-id="f5ca3-186">En Visual Studio, [actualice los paquetes Nuget](https://docs.microsoft.com/en-us/nuget/tools/package-manager-ui#updating-a-package) a las últimas versiones preliminares de lo siguiente:</span><span class="sxs-lookup"><span data-stu-id="f5ca3-186">In Visual Studio, [update Nuget packages](https://docs.microsoft.com/en-us/nuget/tools/package-manager-ui#updating-a-package) to the latest prerelease versions of the following:</span></span>

* `Microsoft.Bot.Builder.Integration.AspNet.Core`
* <span data-ttu-id="f5ca3-187">`Microsoft.Bot.Builder.Ai.QnA` (necesario para QnA Maker)</span><span class="sxs-lookup"><span data-stu-id="f5ca3-187">`Microsoft.Bot.Builder.Ai.QnA` (required for QnA Maker)</span></span>
* <span data-ttu-id="f5ca3-188">`Microsoft.Bot.Builder.Ai.Luis` (necesario para LUIS)</span><span class="sxs-lookup"><span data-stu-id="f5ca3-188">`Microsoft.Bot.Builder.Ai.Luis` (required for LUIS)</span></span>

# <a name="javascripttabjsaddref"></a>[<span data-ttu-id="f5ca3-189">JavaScript</span><span class="sxs-lookup"><span data-stu-id="f5ca3-189">JavaScript</span></span>](#tab/jsaddref)

<span data-ttu-id="f5ca3-190">Descargue el [ejemplo de distribución de LUIS][DispatchBotJs].</span><span class="sxs-lookup"><span data-stu-id="f5ca3-190">Download the [LUIS Dispatch sample][DispatchBotJs].</span></span>  <span data-ttu-id="f5ca3-191">Instale los paquetes necesarios, incluido el paquete `botbuilder-ai` para LUIS y QnA Maker, mediante npm:</span><span class="sxs-lookup"><span data-stu-id="f5ca3-191">Install the required packages, including the `botbuilder-ai` package for LUIS and QnA Maker, using npm:</span></span>

* `npm install --save botbuilder@preview`
* `npm install --save botbuilder-ai@preview`

---


<span data-ttu-id="f5ca3-192">Configure el ejemplo de modo que use la aplicación de distribuidor.</span><span class="sxs-lookup"><span data-stu-id="f5ca3-192">Set up the sample to use the dispatcher app.</span></span>

# <a name="ctabcsbotconfig"></a>[<span data-ttu-id="f5ca3-193">C#</span><span class="sxs-lookup"><span data-stu-id="f5ca3-193">C#</span></span>](#tab/csbotconfig)

<span data-ttu-id="f5ca3-194">En **appsettings.json**, en el [ejemplo de distribución de LUIS][DispatchBotCS], edite los campos siguientes.</span><span class="sxs-lookup"><span data-stu-id="f5ca3-194">In **appsettings.json** in the [LUIS Dispatch sample][DispatchBotCS], edit the following fields.</span></span>

| <span data-ttu-id="f5ca3-195">NOMBRE</span><span class="sxs-lookup"><span data-stu-id="f5ca3-195">Name</span></span> | <span data-ttu-id="f5ca3-196">DESCRIPCIÓN</span><span class="sxs-lookup"><span data-stu-id="f5ca3-196">Description</span></span> |
|------|------|
| `Luis-SubscriptionKey` |  <span data-ttu-id="f5ca3-197">Clave de suscripción de LUIS.</span><span class="sxs-lookup"><span data-stu-id="f5ca3-197">Your LUIS subscription key.</span></span> <span data-ttu-id="f5ca3-198">Puede ser una clave de punto de conexión o una clave de creación, como se describe [aquí](https://docs.microsoft.com/en-us/azure/cognitive-services/luis/luis-concept-keys).</span><span class="sxs-lookup"><span data-stu-id="f5ca3-198">This can be an endpoint key or an authoring key, described [here](https://docs.microsoft.com/en-us/azure/cognitive-services/luis/luis-concept-keys).</span></span> | 
| `Luis-ModelId-Dispatcher` | <span data-ttu-id="f5ca3-199">Identificador de la aplicación de LUIS generada por la herramienta de distribución.</span><span class="sxs-lookup"><span data-stu-id="f5ca3-199">App ID for the LUIS app that the Dispatch tool generates.</span></span> | 
| `Luis-ModelId-HomeAutomation` | <span data-ttu-id="f5ca3-200">Identificador de la aplicación que ha creado a partir de homeautomation.json.</span><span class="sxs-lookup"><span data-stu-id="f5ca3-200">App ID of the app you created from homeautomation.json</span></span>  | 
| `Luis-ModelId-Weather` | <span data-ttu-id="f5ca3-201">Identificador de la aplicación que ha creado a partir de weather.json.</span><span class="sxs-lookup"><span data-stu-id="f5ca3-201">App ID of the app you created from weather.json</span></span> | 
| `QnAMaker-Endpoint-Url` | <span data-ttu-id="f5ca3-202">Debe establecerse en https://westus.api.cognitive.microsoft.com/qnamaker/v2.0 para los servicios QnA Maker de versión preliminar.</span><span class="sxs-lookup"><span data-stu-id="f5ca3-202">This should be set to https://westus.api.cognitive.microsoft.com/qnamaker/v2.0 for Preview QnA Maker services.</span></span> <br/><span data-ttu-id="f5ca3-203">Establezca esta opción en https://YOUR-QNA-SERVICE-NAME.azurewebsites.net/qnamaker para los servicios QnA Maker nuevos (disponibilidad general).</span><span class="sxs-lookup"><span data-stu-id="f5ca3-203">Set this to https://YOUR-QNA-SERVICE-NAME.azurewebsites.net/qnamaker for new (GA) QnA Maker services.</span></span>|
| `QnAMaker-SubscriptionKey` | <span data-ttu-id="f5ca3-204">Clave de suscripción de QnA Maker.</span><span class="sxs-lookup"><span data-stu-id="f5ca3-204">Your QnA Maker subscription key.</span></span> | 
| `QnAMaker-KnowledgeBaseId` | <span data-ttu-id="f5ca3-205">Identificador de la base de conocimiento que cree en el [portal de QnA Maker](https://qnamaker.ai).</span><span class="sxs-lookup"><span data-stu-id="f5ca3-205">The ID of the knowledge base you create at the [QnAMaker portal](https://qnamaker.ai).</span></span>| 



<span data-ttu-id="f5ca3-206">En **Startup.cs**, eche un vistazo al método `ConfigureServices`.</span><span class="sxs-lookup"><span data-stu-id="f5ca3-206">In **Startup.cs**, take a look at the `ConfigureServices` method.</span></span> <span data-ttu-id="f5ca3-207">Contiene código para inicializar `LuisRecognizerMiddleware` con el identificador de la aplicación de LUIS que acaba de generar.</span><span class="sxs-lookup"><span data-stu-id="f5ca3-207">It contains code to initialize `LuisRecognizerMiddleware` using the app ID of the LUIS app you just generated.</span></span>

```csharp
// This method gets called by the runtime. Use this method to add services to the container.
public void ConfigureServices(IServiceCollection services)
{
    services.AddSingleton(this.Configuration);
    services.AddBot<LuisDispatchBot>(options =>
    {
        options.CredentialProvider = new ConfigurationCredentialProvider(Configuration);

        var (luisModelId, luisSubscriptionKey, luisUri) = GetLuisConfiguration(this.Configuration, "Dispatcher");

        var luisModel = new LuisModel(luisModelId, luisSubscriptionKey, luisUri);

        // If you want to get all the intents and scores that LUIS recognized, set Verbose = true in luisOptions
        var luisOptions = new LuisRequest { Verbose = true };

        var middleware = options.Middleware;
        middleware.Add(new LuisRecognizerMiddleware(luisModel, luisOptions: luisOptions));
    });
}
```
<span data-ttu-id="f5ca3-208">Los métodos `GetLuisConfiguration` y `GetQnAMakerConfiguration` obtienen de appsettings.json la configuración de LUIS y de QnA.</span><span class="sxs-lookup"><span data-stu-id="f5ca3-208">The `GetLuisConfiguration` and `GetQnAMakerConfiguration` methods get your LUIS and QnA configuration from appsettings.json.</span></span>
```csharp
public static (string modelId, string subscriptionId, Uri uri) GetLuisConfiguration(IConfiguration configuration, string serviceName)
{
    var modelId = configuration.GetSection($"Luis-ModelId-{serviceName}")?.Value;
    var subscriptionId = configuration.GetSection("Luis-SubscriptionKey")?.Value;
    var uri = new Uri(configuration.GetSection("Luis-Url")?.Value);
    return (modelId, subscriptionId, uri);
}

public static (string knowledgeBaseId, string subscriptionKey, string uri) GetQnAMakerConfiguration(IConfiguration configuration)
{
    var knowledgeBaseId = configuration.GetSection("QnAMaker-KnowledgeBaseId")?.Value;
    var subscriptionKey = configuration.GetSection("QnAMaker-SubscriptionKey")?.Value;
    var uri = configuration.GetSection("QnAMaker-Endpoint-Url")?.Value;
    return (knowledgeBaseId, subscriptionKey, uri);
}
```

### <a name="dispatch-the-message"></a><span data-ttu-id="f5ca3-209">Distribuir el mensaje</span><span class="sxs-lookup"><span data-stu-id="f5ca3-209">Dispatch the message</span></span>

<span data-ttu-id="f5ca3-210">Eche un vistazo a **LuisDispatchBot.cs**, donde el bot distribuye el mensaje a la aplicación de LUIS o de QnA Maker para un subcomponente.</span><span class="sxs-lookup"><span data-stu-id="f5ca3-210">Take a look at **LuisDispatchBot.cs**, where the bot dispatches the message to the LUIS app or QnA Maker for a subcomponent.</span></span> 

<span data-ttu-id="f5ca3-211">En `DispatchToTopIntent`, si la aplicación de distribuidor detecta la intención `l_homeautomation` o `l_weather`, llama a un método `DispatchToTopIntent` que crea un `LuisRecognizer` para llamar a las aplicaciones originales `homeautomation` y `weather`.</span><span class="sxs-lookup"><span data-stu-id="f5ca3-211">In `DispatchToTopIntent`, if your dispatcher app detects the `l_homeautomation` or `l_weather` intent, it calls a `DispatchToTopIntent` method that creates a `LuisRecognizer` to call the original `homeautomation` and `weather` apps.</span></span> <span data-ttu-id="f5ca3-212">Si el bot detecta la intención `q_faq`, o bien la intención `none` que se usa como caso de reserva, llama a un método que realiza una consulta a QnA Maker.</span><span class="sxs-lookup"><span data-stu-id="f5ca3-212">If the bot detects the `q_faq` intent, or the `none` intent that is used as a fallback case, it calls a method that queries QnAMaker.</span></span>

> [!NOTE] 
> <span data-ttu-id="f5ca3-213">Si los nombres de intención `l_homeautomation`, `l_weather` o `q_faq` no coinciden con la aplicación de LUIS que ha creado mediante la herramienta de distribución, modifíquelos para que coincidan con la versión en minúsculas de los nombres de intención que se ven en el [portal de LUIS](https://www.luis.ai).</span><span class="sxs-lookup"><span data-stu-id="f5ca3-213">If the intent names `l_homeautomation`, `l_weather` or `q_faq` don't match the LUIS app you created using Dispatch, edit them to match the lower case version of the intent names you see in the [LUIS portal](https://www.luis.ai).</span></span>

```csharp
private async Task DispatchToTopIntent(ITurnContext context, (string intent, double score)? topIntent)
{
    switch (topIntent.Value.intent.ToLowerInvariant())
    {
        case "l_homeautomation":
            await DispatchToLuisModel(context, this.luisModelHomeAutomation, "home automation");
            break;
        case "l_weather":
            await DispatchToLuisModel(context, this.luisModelWeather, "weather");
            break;
        case "none":
        // You can provide logic here to handle the known None intent (none of the above).
        // In this example we fall through to the QnA intent.
        case "q_faq":
            await DispatchToQnAMaker(context, this.qnaEndpoint, "FAQ");
            break;
        default:
            // The intent didn't match any case, so just display the recognition results.
            await context.SendActivity($"Dispatch intent: {topIntent.Value.intent} ({topIntent.Value.score}).");

            break;
    }
}
```

<span data-ttu-id="f5ca3-214">El método `DispatchToQnAMaker` envía el mensaje del usuario al servicio QnA Maker.</span><span class="sxs-lookup"><span data-stu-id="f5ca3-214">The `DispatchToQnAMaker` method sends the user's message to the QnA Maker service.</span></span> <span data-ttu-id="f5ca3-215">Asegúrese de que ha publicado ese servicio en el [portal de QnA Maker](https://qnamaker.ai) antes de ejecutar el bot.</span><span class="sxs-lookup"><span data-stu-id="f5ca3-215">Make sure you have published that service in the [QnA Maker portal](https://qnamaker.ai) before you run the bot.</span></span>

```csharp
private static async Task DispatchToQnAMaker(ITurnContext context, QnAMakerEndpoint qnaOptions, string appName)
{
    QnAMaker qnaMaker = new QnAMaker(qnaOptions);
    if (!string.IsNullOrEmpty(context.Activity.Text))
    {
        var results = await qnaMaker.GetAnswers(context.Activity.Text.Trim()).ConfigureAwait(false);
        if (results.Any())
        {
            await context.SendActivity(results.First().Answer);
        }
        else
        {
            await context.SendActivity($"Couldn't find an answer in the {appName}.");
        }
    }
}
```

<span data-ttu-id="f5ca3-216">El método `DispatchToLuisModel` envía el mensaje del usuario a las aplicaciones de LUIS originales `homeautomation` y `weather`.</span><span class="sxs-lookup"><span data-stu-id="f5ca3-216">The `DispatchToLuisModel` method sends the user's message to the original `homeautomation` and `weather` LUIS apps.</span></span> <span data-ttu-id="f5ca3-217">Asegúrese de que ha publicado esas aplicaciones de LUIS en el [portal de LUIS](https://www.luis.ai) antes de ejecutar el bot.</span><span class="sxs-lookup"><span data-stu-id="f5ca3-217">Make sure you have published those LUIS apps in the [LUIS portal](https://www.luis.ai) before you run the bot.</span></span>

```csharp
private static async Task DispatchToLuisModel(ITurnContext context, LuisModel luisModel, string appName)
{
    await context.SendActivity($"Sending your request to the {appName} system ...");
    var (intents, entities) = await RecognizeAsync(luisModel, context.Activity.Text);

    await context.SendActivity($"Intents detected by the {appName} app:\n\n{string.Join("\n\n", intents)}");

    if (entities.Count() > 0)
    {
        await context.SendActivity($"The following entities were found in the message:\n\n{string.Join("\n\n", entities)}");
    }
    
    // Here, you can add code for calling the hypothetical home automation or weather service, 
    // passing in the appName and any intent or entity information that you need 
}
```

<span data-ttu-id="f5ca3-218">El método `RecognizeAsync` llama a un `LuisRecognizer` para obtener resultados de una aplicación de LUIS.</span><span class="sxs-lookup"><span data-stu-id="f5ca3-218">The `RecognizeAsync` method calls a `LuisRecognizer` to get results from a LUIS app.</span></span>

```cs
private static async Task<(IEnumerable<string> intents, IEnumerable<string> entities)> RecognizeAsync(LuisModel luisModel, string text)
{
    var luisRecognizer = new LuisRecognizer(luisModel);
    var recognizerResult = await luisRecognizer.Recognize(text, System.Threading.CancellationToken.None);

    // list the intents
    var intents = new List<string>();
    foreach (var intent in recognizerResult.Intents)
    {
        intents.Add($"'{intent.Key}', score {intent.Value}");
    }

    // list the entities
    var entities = new List<string>();
    foreach (var entity in recognizerResult.Entities)
    {
        if (!entity.Key.ToString().Equals("$instance"))
        {
            entities.Add($"{entity.Key}: {entity.Value.First}");
        }
    }

    return (intents, entities);
}
```

# <a name="javascripttabjsbotconfig"></a>[<span data-ttu-id="f5ca3-219">JavaScript</span><span class="sxs-lookup"><span data-stu-id="f5ca3-219">JavaScript</span></span>](#tab/jsbotconfig)

<span data-ttu-id="f5ca3-220">Comience con el código del [ejemplo de bot de distribución][DispatchBotJs].</span><span class="sxs-lookup"><span data-stu-id="f5ca3-220">Start with the code in the [Dispatch bot sample][DispatchBotJs].</span></span> <span data-ttu-id="f5ca3-221">Abra **app.js** y, opcionalmente, reemplace los campos `appId` por los identificadores de las aplicaciones de LUIS que ha creado.</span><span class="sxs-lookup"><span data-stu-id="f5ca3-221">Open **app.js** and optionally replace the `appId` fields with the IDs of the LUIS apps you created.</span></span> <span data-ttu-id="f5ca3-222">Si deja los campos `appId` como estaban originalmente, usará aplicaciones de LUIS públicas creadas con fines de demostración.</span><span class="sxs-lookup"><span data-stu-id="f5ca3-222">If you leave the `appId` fields as they originally are, you'll be using public LUIS apps created for demonstration purposes.</span></span>

```javascript
// Create LuisRecognizers and QnAMaker
// The LUIS applications are public, meaning you can use your own subscription key to test the applications.
// For QnAMaker, users are required to create their own knowledge base.
// The exported LUIS applications and QnAMaker knowledge base can be found with the sample bot.

// The corresponding LUIS application JSON is `dispatchSample.json`
const dispatcher = new LuisRecognizer({
    appId: '0b18ab4f-5c3d-4724-8b0b-191015b48ea9',
    subscriptionKey: process.env.LUIS_SUBSCRIPTION_KEY,
    serviceEndpoint: 'https://westus.api.cognitive.microsoft.com/',
    verbose: true
});

// The corresponding LUIS application JSON is `homeautomation.json`
const homeAutomation = new LuisRecognizer({
    appId: 'c6d161a5-e3e5-4982-8726-3ecec9b4ed8d',
    subscriptionKey: process.env.LUIS_SUBSCRIPTION_KEY,
    serviceEndpoint: 'https://westus.api.cognitive.microsoft.com/',
    verbose: true
});

// The corresponding LUIS application JSON is `weather.json`
const weather = new LuisRecognizer({
    appId: '9d0c9e9d-ce04-4257-a08a-a612955f2fb5',
    subscriptionKey: process.env.LUIS_SUBSCRIPTION_KEY,
    serviceEndpoint: 'https://westus.api.cognitive.microsoft.com/',
    verbose: true
});
```

<span data-ttu-id="f5ca3-223">En el código siguiente, reemplace `endpointKey` y `knowledgeBaseID` por la clave y el identificador de la base de conocimiento de QnA Maker.</span><span class="sxs-lookup"><span data-stu-id="f5ca3-223">In the following code, replace the `endpointKey` and `knowledgeBaseID` with your key and knowledge base ID from QnAMaker.</span></span> <span data-ttu-id="f5ca3-224">El `host` debe establecerse en `https://westus.api.cognitive.microsoft.com/qnamaker/v2.0` para los servicios QnA Maker de versión preliminar, y `https://YOUR-QNA-SERVICE-NAME.azurewebsites.net/qnamaker` para los servicios QnA Maker nuevos (disponibilidad general).</span><span class="sxs-lookup"><span data-stu-id="f5ca3-224">The `host` should be set to `https://westus.api.cognitive.microsoft.com/qnamaker/v2.0` for Preview QnA Maker services, and `https://YOUR-QNA-SERVICE-NAME.azurewebsites.net/qnamaker` for new (GA) QnA Maker services.</span></span>

```javascript
const faq = new QnAMaker(
    {
        knowledgeBaseId: '',
        endpointKey: '',
        host: ''
    },
    {
        answerBeforeNext: true
    }
);

```

<span data-ttu-id="f5ca3-225">El resto del código en **app.js** controla las intenciones `l_homeautomation`, `l_weather` y `None`, para lo que inicia los cuadros de diálogo pertinentes.</span><span class="sxs-lookup"><span data-stu-id="f5ca3-225">The rest of the code in **app.js** handles the `l_homeautomation`, `l_weather`, and `None` intents by launching appropriate dialogs.</span></span> <span data-ttu-id="f5ca3-226">En el caso de la intención `q_faq`, responde con la respuesta desde el servicio QnA Maker.</span><span class="sxs-lookup"><span data-stu-id="f5ca3-226">In the case of the `q_faq` intent, it replies with the answer from the QnAMaker service.</span></span>

> [!NOTE] 
> <span data-ttu-id="f5ca3-227">Si los nombres de intención `l_homeautomation`, `l_weather` o `q_faq` no coinciden con la aplicación de LUIS que ha creado mediante la herramienta de distribución, modifíquelos para que coincidan con los nombres de intención que se ven en el [portal de LUIS](https://www.luis.ai).</span><span class="sxs-lookup"><span data-stu-id="f5ca3-227">If the intent names `l_homeautomation`, `l_weather` or `q_faq` don't match the LUIS app you created using Dispatch, edit them to match the intent names you see in the [LUIS portal](https://www.luis.ai).</span></span>

```javascript
// create conversation state
const conversationState = new ConversationState(new MemoryStorage());
adapter.use(conversationState);

// register some dialogs for usage with the LUIS apps that are being dispatched to
const dialogs = new DialogSet();

function findEntities(entityName, entityResults) {
    let entities = []
    if (entityName in entityResults) {
        entityResults[entityName].forEach((entity, idx) => {
            entities.push(entity);
        });
    }
    return entities.length > 0 ? entities : undefined;
}

dialogs.add('HomeAutomation_TurnOff', [
    async (dialogContext, args) => {
        const devices = findEntities('HomeAutomation_Device', args.entities);
        const operations = findEntities('HomeAutomation_Operation', args.entities);

        const state = conversationState.get(dialogContext.context);
        state.homeAutomationTurnOff = state.homeAutomationTurnOff ? state.homeAutomationTurnOff + 1 : 1;
        await dialogContext.context.sendActivity(`${state.homeAutomationTurnOff}: You reached the "HomeAutomation.TurnOff" dialog.`);
        if (devices) {
            await dialogContext.context.sendActivity(`Found these "HomeAutomation_Device" entities:\n${devices.join(', ')}`);
        }
        if (operations) {
            await dialogContext.context.sendActivity(`Found these "HomeAutomation_Operation" entities:\n${operations.join(', ')}`);
        }
        await dialogContext.end();
    }
]);

dialogs.add('HomeAutomation_TurnOn', [
    async (dialogContext, args) => {
        const devices = findEntities('HomeAutomation_Device', args.entities);
        const operations = findEntities('HomeAutomation_Operation', args.entities);

        const state = conversationState.get(dialogContext.context);
        state.homeAutomationTurnOn = state.homeAutomationTurnOn ? state.homeAutomationTurnOn + 1 : 1;
        await dialogContext.context.sendActivity(`${state.homeAutomationTurnOn}: You reached the "HomeAutomation.TurnOn" dialog.`);
        if (devices) {
            await dialogContext.context.sendActivity(`Found these "HomeAutomation_Device" entities:\n${devices.join(', ')}`);
        }
        if (operations) {
            await dialogContext.context.sendActivity(`Found these "HomeAutomation_Operation" entities:\n${operations.join(', ')}`);
        }
        await dialogContext.end();
    }
]);

dialogs.add('Weather_GetForecast', [
    async (dialogContext, args) => {
        const locations = findEntities('Weather_Location', args.entities);

        const state = conversationState.get(dialogContext.context);
        state.weatherGetForecast = state.weatherGetForecast ? state.weatherGetForecast + 1 : 1;
        await dialogContext.context.sendActivity(`${state.weatherGetForecast}: You reached the "Weather.GetForecast" dialog.`);
        if (locations) {
            await dialogContext.context.sendActivity(`Found these "Weather_Location" entities:\n${locations.join(', ')}`);
        }
        await dialogContext.end();
    }
]);

dialogs.add('Weather_GetCondition', [
    async (dialogContext, args) => {
        const locations = findEntities('Weather_Location', args.entities);

        const state = conversationState.get(dialogContext.context);
        state.weatherGetCondition = state.weatherGetCondition ? state.weatherGetCondition + 1 : 1;
        await dialogContext.context.sendActivity(`${state.weatherGetCondition}: You reached the "Weather.GetCondition" dialog.`);
        if (locations) {
            await dialogContext.context.sendActivity(`Found these "Weather_Location" entities:\n${locations.join(', ')}`);
        }
        await dialogContext.end();
    }
]);

dialogs.add('None', [
    async (dialogContext) => {
        const state = conversationState.get(dialogContext.context);
        state.noneIntent = state.noneIntent ? state.noneIntent + 1 : 1;
        await dialogContext.context.sendActivity(`${state.noneIntent}: You reached the "None" dialog.`);
        await dialogContext.end();
    }
]);

adapter.use(dispatcher);

// Listen for incoming Activities
server.post('/api/messages', (req, res) => {
    adapter.processActivity(req, res, async (context) => {
        if (context.activity.type === 'message') {
            const state = conversationState.get(context);
            const dc = dialogs.createContext(context, state);

            // Retrieve the LUIS results from our dispatcher LUIS application
            const luisResults = dispatcher.get(context);

            // Extract the top intent from LUIS and use it to select which LUIS application to dispatch to
            const topIntent = LuisRecognizer.topIntent(luisResults);

            const isMessage = context.activity.type === 'message';
            if (isMessage) {
                switch (topIntent) {
                    case 'l_homeautomation':
                        const homeAutoResults = await homeAutomation.recognize(context);
                        const topHomeAutoIntent = LuisRecognizer.topIntent(homeAutoResults);
                        await dc.begin(topHomeAutoIntent, homeAutoResults);
                        break;
                    case 'l_weather':
                        const weatherResults = await weather.recognize(context);
                        const topWeatherIntent = LuisRecognizer.topIntent(weatherResults);
                        await dc.begin(topWeatherIntent, weatherResults);
                        break;
                    case 'q_faq':
                        await faq.answer(context);
                        break;
                    default:
                        await dc.begin('None');
                }
            }

            if (!context.responded) {
                await dc.continue();
                if (!context.responded && isMessage) {
                    await dc.context.sendActivity(`Hi! I'm the LUIS dispatch bot. Say something and LUIS will decide how the message should be routed.`);
                }
            }
        }
    });
});

```

---
## <a name="run-the-bot"></a><span data-ttu-id="f5ca3-228">Ejecutar el bot</span><span class="sxs-lookup"><span data-stu-id="f5ca3-228">Run the bot</span></span>

<span data-ttu-id="f5ca3-229">Pruebe el bot con [Bot Framework Emulator](../bot-service-debug-emulator.md).</span><span class="sxs-lookup"><span data-stu-id="f5ca3-229">Test out the bot using the [Bot Framework Emulator](../bot-service-debug-emulator.md).</span></span> <span data-ttu-id="f5ca3-230">Envíele un mensaje como "encender las luces" para distribuir el mensaje a la aplicación de LUIS de automatización del hogar, y un mensaje como "consultar la información meteorológica en Seattle" para enviarlo a la aplicación de LUIS de información meteorológica.</span><span class="sxs-lookup"><span data-stu-id="f5ca3-230">Send it messages like "turn on the lights" to dispatch the message to the home automation LUIS app, and send it messages like "get the weather in Seattle" to dispatch to the weather LUIS app.</span></span>

> [!NOTE] 
> <span data-ttu-id="f5ca3-231">Antes de ejecutar el bot, asegúrese de que ha publicado todas las aplicaciones LUIS que ha creado en el [portal de LUIS](https://www.luis.ai) y compruebe que ha publicado el servicio QnA Maker en el [portal de QnA Maker](https://qnamaker.ai).</span><span class="sxs-lookup"><span data-stu-id="f5ca3-231">Before you run the bot, make sure you have published all the LUIS apps that you created in the [LUIS portal](https://www.luis.ai), and check that you've published the QnA Maker service in the [QnA Maker portal](https://qnamaker.ai).</span></span>

![Enviar mensajes al bot de distribución](media/tutorial-dispatch/run-dispatch-bot.png)

## <a name="evaluate-the-dispatchers-performance"></a><span data-ttu-id="f5ca3-233">Evaluar el rendimiento del distribuidor</span><span class="sxs-lookup"><span data-stu-id="f5ca3-233">Evaluate the dispatcher's performance</span></span>

<span data-ttu-id="f5ca3-234">Algunos mensajes de usuario se proporcionan como ejemplos en las aplicaciones de LUIS y los servicios QnA Maker, y la aplicación de LUIS combinada que la herramienta de distribución genera no funcionará bien para esas entradas.</span><span class="sxs-lookup"><span data-stu-id="f5ca3-234">Sometimes there are user messages that are provided as examples in both the LUIS apps and the QnA maker services, and the combined LUIS app that Dispatch generates won't perform well for those inputs.</span></span> <span data-ttu-id="f5ca3-235">Para comprobar el rendimiento de su aplicación, use la opción `eval`.</span><span class="sxs-lookup"><span data-stu-id="f5ca3-235">Check your app's performance using the `eval` option.</span></span> 

```
dispatch eval
```

<span data-ttu-id="f5ca3-236">Al ejecutar `dispatch eval` se genera un archivo **Summary.html** que proporciona estadísticas sobre el rendimiento del nuevo modelo de lenguaje.</span><span class="sxs-lookup"><span data-stu-id="f5ca3-236">Running `dispatch eval` generates a **Summary.html** file that provides statistics on the performance of the new language model.</span></span>

> [!TIP] 
> <span data-ttu-id="f5ca3-237">Puede ejecutar `dispatch eval` en cualquier aplicación de LUIS, no solo en las aplicaciones de LUIS que ha creado la herramienta de distribución.</span><span class="sxs-lookup"><span data-stu-id="f5ca3-237">You can actually run `dispatch eval` on any LUIS app, not just LUIS apps created by the dispatch tool.</span></span>

### <a name="edit-intents-for-duplicates-and-overlaps"></a><span data-ttu-id="f5ca3-238">Editar las intenciones para los duplicados y las superposiciones</span><span class="sxs-lookup"><span data-stu-id="f5ca3-238">Edit intents for duplicates and overlaps</span></span>

<span data-ttu-id="f5ca3-239">Revise las expresiones de ejemplo marcadas como duplicados en **Summary.html** y quite los ejemplos similares o que se superponen.</span><span class="sxs-lookup"><span data-stu-id="f5ca3-239">Review example utterances that are flagged as duplicates in **Summary.html**, and remove similar or overlapping examples.</span></span> <span data-ttu-id="f5ca3-240">Por ejemplo, supongamos que en la aplicación de LUIS `homeautomation` para la automatización del hogar, las solicitudes como "encender las luces" se asignan a una intención "TurnOnLights", pero las solicitudes como "¿Por qué no se encienden las luces?"</span><span class="sxs-lookup"><span data-stu-id="f5ca3-240">For example, let's say that in the `homeautomation` LUIS app for homeautomation, requests like "turn my lights on" map to a "TurnOnLights" intent, but requests like "Why won't my lights turn on?"</span></span> <span data-ttu-id="f5ca3-241">se asignan a una intención "None" para que se puedan pasar a QnA Maker.</span><span class="sxs-lookup"><span data-stu-id="f5ca3-241">map to a "None" intent so that they can be passed on to QnA maker.</span></span> <span data-ttu-id="f5ca3-242">Al combinar la aplicación de LUIS y el servicio QnA Maker mediante la herramienta de distribución, es preciso llevar a cabo una de las acciones siguientes:</span><span class="sxs-lookup"><span data-stu-id="f5ca3-242">When you combine the LUIS app and the QnA maker service using dispatch, you need to do one of the following:</span></span> 

* <span data-ttu-id="f5ca3-243">Quitar la intención "None" de la aplicación de LUIS `homeautomation` original y agregar las expresiones de dicha intención a la intención "None" de la aplicación de distribuidor.</span><span class="sxs-lookup"><span data-stu-id="f5ca3-243">Remove the "None" intent from the original `homeautomation` LUIS app, and add the utterances in that intent to the "None" intent in the dispatcher app.</span></span>
* <span data-ttu-id="f5ca3-244">Si no quita la intención "None" de la aplicación de LUIS original, deberá agregar lógica en su bot para pasar los mensajes que coinciden con dicha intención al servicio QnA Maker.</span><span class="sxs-lookup"><span data-stu-id="f5ca3-244">If you don't remove the "None" intent from the original LUIS app, you need to add logic in your bot to pass those messages that match that intent on to the QnA maker service.</span></span>

> [!TIP] 
> <span data-ttu-id="f5ca3-245">Vea [Best practices for Language Understanding](./bot-builder-concept-luis.md#best-practices-for-language-understanding) (Procedimientos recomendados para Language Understanding) para obtener sugerencias sobre cómo mejorar el rendimiento del modelo de lenguaje.</span><span class="sxs-lookup"><span data-stu-id="f5ca3-245">Review [Best practices for Language Understanding](./bot-builder-concept-luis.md#best-practices-for-language-understanding) for tips on improving your language model's performance.</span></span>

## <a name="additional-resources"></a><span data-ttu-id="f5ca3-246">Recursos adicionales</span><span class="sxs-lookup"><span data-stu-id="f5ca3-246">Additional resources</span></span>

* <span data-ttu-id="f5ca3-247">[Uso de LUIS para el flujo de conversación][luis-v4-how-to]</span><span class="sxs-lookup"><span data-stu-id="f5ca3-247">[Using LUIS for conversation flow][luis-v4-how-to]</span></span>

[luis-v4-how-to]: bot-builder-howto-v4-luis.md
<!-- links -->

[HomeAutomationJSON]: https://aka.ms/dispatch-luis1
[WeatherJSON]: https://aka.ms/dispatch-luis2
[DispatchJSON]: https://aka.ms/dispatch-luis
[FAQ_TSV]: https://aka.ms/dispatch-qna-tsv

[DispatchTool]: https://github.com/Microsoft/botbuilder-tools/tree/master/Dispatch
[DispatchBotCS]: https://aka.ms/dispatch-sample-cs
[DispatchBotJs]: https://aka.ms/dispatch-sample-js



