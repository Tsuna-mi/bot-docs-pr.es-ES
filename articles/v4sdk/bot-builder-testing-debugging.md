---
title: Directrices de prueba y depuración | Microsoft Docs
description: Comprenda cómo probar y depurar el bot.
keywords: principios de prueba, elementos ficticios, preguntas más frecuentes, niveles de prueba
author: ivorb
ms.author: v-ivorb
manager: kamrani
ms.topic: article
ms.prod: bot-framework
ms.date: 04/09/2018
monikerRange: azure-bot-service-4.0
ms.openlocfilehash: 4195ae016513c809e4677879e0abe1b2bf8d799e
ms.sourcegitcommit: 3cb288cf2f09eaede317e1bc8d6255becf1aec61
ms.translationtype: HT
ms.contentlocale: es-ES
ms.lasthandoff: 09/27/2018
ms.locfileid: "47389784"
---
# <a name="testing-and-debugging-guidelines"></a><span data-ttu-id="43677-104">Directrices de prueba y depuración</span><span class="sxs-lookup"><span data-stu-id="43677-104">Testing and debugging guidelines</span></span>

[!INCLUDE [pre-release-label](../includes/pre-release-label.md)]

<span data-ttu-id="43677-105">Los bots son aplicaciones complejas con una gran cantidad de elementos diferentes que funcionan conjuntamente.</span><span class="sxs-lookup"><span data-stu-id="43677-105">Bots are complex apps, with a lot of different parts working together.</span></span> <span data-ttu-id="43677-106">Como cualquier otra aplicación compleja, esto puede provocar algunos errores interesantes o que el bot se comporte de forma diferente a la esperada.</span><span class="sxs-lookup"><span data-stu-id="43677-106">Like any other complex app, this can lead to some interesting bugs or cause your bot to behave differently than expected.</span></span>

<span data-ttu-id="43677-107">A veces, la prueba del bot y posteriormente su depuración puede ser una tarea difícil.</span><span class="sxs-lookup"><span data-stu-id="43677-107">Testing, and subsequently debugging, your bot can sometimes be a difficult task.</span></span> <span data-ttu-id="43677-108">Cada desarrollador tiene su propia manera preferida de realizar esa tarea. Las directrices que se presentan a continuación son sugerencias que puede usar y que se aplican a la gran mayoría de los bots.</span><span class="sxs-lookup"><span data-stu-id="43677-108">Every developer has their own preferred way to accomplish that task; guidelines we present below are suggestions for you to use that apply to a large majority of bots.</span></span>

## <a name="testing-your-bot"></a><span data-ttu-id="43677-109">Prueba del bot</span><span class="sxs-lookup"><span data-stu-id="43677-109">Testing your bot</span></span>

<span data-ttu-id="43677-110">Las directrices siguientes se presentan en tres **niveles** diferentes.</span><span class="sxs-lookup"><span data-stu-id="43677-110">The guidelines below are presented in three different **levels**.</span></span>  <span data-ttu-id="43677-111">Cada nivel agrega complejidad y características a la prueba, por lo que le sugerimos que se conforme con un nivel antes de pasar al siguiente.</span><span class="sxs-lookup"><span data-stu-id="43677-111">Each level adds complexity and features to the testing, and we therefore suggest that you’re happy with one level before moving onto the next.</span></span> <span data-ttu-id="43677-112">De esta forma, podrá aislar y solucionar los problemas de nivel más bajo en primer lugar antes de agregar más complejidad.</span><span class="sxs-lookup"><span data-stu-id="43677-112">Doing so will allow you to isolate and fix the lowest level issues first before adding more complexity.</span></span>

<span data-ttu-id="43677-113">Los procedimientos recomendados de la prueba tratarán diferentes ángulos siempre que sea aplicable.</span><span class="sxs-lookup"><span data-stu-id="43677-113">Testing best practice will cover different angles wherever applicable.</span></span> <span data-ttu-id="43677-114">Pueden incluir seguridad, integración, direcciones URL con formato incorrecto, vulnerabilidades de seguridad de validación, códigos de estado HTTP, cargas JSON, valores null, etc.</span><span class="sxs-lookup"><span data-stu-id="43677-114">This may include security, integration, badly formed URLs, validation exploits, HTTP status codes, JSON payloads, null values and so on.</span></span> <span data-ttu-id="43677-115">Si el bot se encarga de toda la información que afecta a la privacidad del usuario, esto es especialmente importante.</span><span class="sxs-lookup"><span data-stu-id="43677-115">If your bot handles any information that has impact on user privacy, this is particularly important.</span></span>

### <a name="level-1-use-mock-elements"></a><span data-ttu-id="43677-116">Nivel 1: uso de elementos ficticios</span><span class="sxs-lookup"><span data-stu-id="43677-116">Level 1: Use mock elements</span></span>

<span data-ttu-id="43677-117">Lo que garantiza que cada fragmento de la aplicación, o bien, en este caso nuestro bot, funcione exactamente como debería, es el primer nivel de pruebas.</span><span class="sxs-lookup"><span data-stu-id="43677-117">Ensuring that each small piece of your app, or in this case our bot, works exactly as it should, is the first level of testing.</span></span> <span data-ttu-id="43677-118">Para lograr esto, puede usar elementos ficticios para las cosas que no está probando actualmente.</span><span class="sxs-lookup"><span data-stu-id="43677-118">To achieve this, you can use mock elements for the things you’re not currently testing.</span></span> <span data-ttu-id="43677-119">Como referencia, este nivel puede considerarse generalmente como unidad y prueba de integración.</span><span class="sxs-lookup"><span data-stu-id="43677-119">For reference, this level can generally be thought of as unit and integration testing.</span></span>

<span data-ttu-id="43677-120">**Uso de elementos ficticios para probar secciones individuales**</span><span class="sxs-lookup"><span data-stu-id="43677-120">**Use mock elements to test individual sections**</span></span>

<span data-ttu-id="43677-121">La simulación de tantos elementos como pueda permite un mejor aislamiento de la pieza que está probando.</span><span class="sxs-lookup"><span data-stu-id="43677-121">Mocking as many elements as you can allows for better isolation of the piece you’re testing.</span></span> <span data-ttu-id="43677-122">Los candidatos para los elementos ficticios incluyen el almacenamiento, el adaptador, el software intermedio, la canalización de actividades, los canales y cualquier otra cosa que no forme parte del bot directamente.</span><span class="sxs-lookup"><span data-stu-id="43677-122">Candidates for mock elements include storage, the adapter, middleware, activity pipeline, channels, and anything else that is not directly part of your bot.</span></span> <span data-ttu-id="43677-123">También se podrían quitar ciertos aspectos temporalmente, como el software intermedio no implicado en la parte del bot que está probando, para aislar cada fragmento.</span><span class="sxs-lookup"><span data-stu-id="43677-123">This could also be removing certain aspects temporarily, such as middleware not involved in the part of your bot that you are testing, to isolate each piece.</span></span> <span data-ttu-id="43677-124">Sin embargo, si va a probar su software intermedio, es posible que quiera simular el bot en su lugar.</span><span class="sxs-lookup"><span data-stu-id="43677-124">However, if you are testing your middleware, you may want to mock your bot instead.</span></span>

<span data-ttu-id="43677-125">La simulación de elementos puede asumir formas diferentes, desde el reemplazo de un elemento por otro objeto conocido a la implementación de una funcionalidad básica de Hola mundo.</span><span class="sxs-lookup"><span data-stu-id="43677-125">Mocking elements can take a handful of forms, from replacing an element with a different known object to implementing a bare bones hello world functionality.</span></span> <span data-ttu-id="43677-126">También puede consistir en la eliminación del elemento simplemente, en caso de que no sea necesario, así como en forzarlo a no hacer nada.</span><span class="sxs-lookup"><span data-stu-id="43677-126">This could also take the form of simply removing the element, if it’s not necessary, or simply force it to do nothing.</span></span> 

<span data-ttu-id="43677-127">Este método debe ejercitar funciones y métodos individuales en el bot.</span><span class="sxs-lookup"><span data-stu-id="43677-127">This level should exercise individual methods and functions within your bot.</span></span> <span data-ttu-id="43677-128">La prueba de métodos individuales se puede realizar a través de pruebas unitarias integradas, lo cual se recomienda, con su propia aplicación de prueba o conjunto de pruebas, o bien de forma manual si lo hace dentro del IDE.</span><span class="sxs-lookup"><span data-stu-id="43677-128">Testing individual methods could be through built in unit tests, which are recommended, with your own testing app or test suite, or manually doing so within your IDE.</span></span> 

<span data-ttu-id="43677-129">**Uso de elementos ficticios para probar características mayores**</span><span class="sxs-lookup"><span data-stu-id="43677-129">**Use mock elements to test larger features**</span></span>

<span data-ttu-id="43677-130">Cuando esté satisfecho con el comportamiento de cada método, use estos elementos ficticios para probar características más completas en el bot.</span><span class="sxs-lookup"><span data-stu-id="43677-130">Once you are happy with how each method behaves, use these mock elements to test more complete features in your bot.</span></span> <span data-ttu-id="43677-131">Esto demuestra como unas pocas capas funcionan conjuntamente para conversar con el usuario.</span><span class="sxs-lookup"><span data-stu-id="43677-131">This demonstrates how a few layers work together to converse with your user.</span></span> 

<span data-ttu-id="43677-132">Para ayudarle, se proporcionan diferentes herramientas.</span><span class="sxs-lookup"><span data-stu-id="43677-132">A handful of tools are provided to help with this.</span></span> <span data-ttu-id="43677-133">Por ejemplo, [Azure Bot Framework Emulator](https://github.com/Microsoft/BotFramework-Emulator) proporciona un canal emulado para comunicarse con el bot.</span><span class="sxs-lookup"><span data-stu-id="43677-133">For example, the [Azure Bot Framework Emulator](https://github.com/Microsoft/BotFramework-Emulator) provides an emulated channel to communicate with your bot.</span></span> <span data-ttu-id="43677-134">Mediante el emulador, se obtiene una situación más compleja que la unidad y las pruebas de integración y, por lo tanto, también se pasa al siguiente nivel de pruebas.</span><span class="sxs-lookup"><span data-stu-id="43677-134">Using the emulator gets into a more complex situation than just unit and integration testing, and therefore also spills over into the next level of testing.</span></span>

### <a name="level-2-use-a-direct-line-client"></a><span data-ttu-id="43677-135">Nivel 2: uso de un cliente de Direct Line</span><span class="sxs-lookup"><span data-stu-id="43677-135">Level 2: Use a Direct Line client</span></span>

<span data-ttu-id="43677-136">Después de comprobar si el bot funciona como le gustaría, el siguiente paso consiste en conectarlo a un canal.</span><span class="sxs-lookup"><span data-stu-id="43677-136">After verifying your bot appears to work how you’d like it to, the next step is connecting it to a channel.</span></span> <span data-ttu-id="43677-137">Para ello, puede implementarlo en un servidor de almacenamiento provisional y crear su propio cliente de línea directa <!--IBTODO [Direct Line client](bot-builder-howto-direct-line.md)--> del bot al que conectarse.</span><span class="sxs-lookup"><span data-stu-id="43677-137">To do this, you can deploy your bot to a staging server and create your own <!--IBTODO [Direct Line client](bot-builder-howto-direct-line.md)--> direct line client for your bot to connect to.</span></span>

<span data-ttu-id="43677-138">La creación de su propio cliente le permite definir el funcionamiento interno del canal, así como probar específicamente cómo responde el bot a determinados intercambios de actividad.</span><span class="sxs-lookup"><span data-stu-id="43677-138">Creating your own client allows you to define the inner workings of the channel, as well as specifically test how your bot responds to certain activity exchanges.</span></span> <span data-ttu-id="43677-139">Una vez conectado al cliente, ejecute las pruebas para configurar el estado del bot y comprobar sus características.</span><span class="sxs-lookup"><span data-stu-id="43677-139">Once connected to your client, run your tests to set up your bot state and verify your features.</span></span> <span data-ttu-id="43677-140">Si el bot usa una característica como la voz, el uso de estos canales puede ofrecer una manera de comprobar esa funcionalidad.</span><span class="sxs-lookup"><span data-stu-id="43677-140">If your bot utilizes a feature like speech, using these channels can offer a way to verify that functionality.</span></span>

<span data-ttu-id="43677-141">El uso del emulador y del Chat en web a través de Azure Portal puede proporcionar más información sobre el rendimiento del bot al interactuar con distintos canales.</span><span class="sxs-lookup"><span data-stu-id="43677-141">Use of both the Emulator and Web Chat via Azure portal here can provide further insight into how your bot performs while interacting with different channels.</span></span>

### <a name="level-3-channel-tests"></a><span data-ttu-id="43677-142">Nivel 3: pruebas del canal</span><span class="sxs-lookup"><span data-stu-id="43677-142">Level 3: Channel tests</span></span>

<span data-ttu-id="43677-143">Una vez que esté seguro del rendimiento independiente del bot, es importante ver cómo funciona con distintos canales en los que estará disponible.</span><span class="sxs-lookup"><span data-stu-id="43677-143">Once you’re confident in your bot’s independent performance, it’s important to see how it works with various channels that it will be available on.</span></span> 

<span data-ttu-id="43677-144">La forma de conseguirlo puede variar considerablemente, desde su uso individual con distintos canales y exploradores al uso con una herramienta de terceros, como [Selenium](https://docs.seleniumhq.org/), para interactuar a través de un canal y extraer las respuestas del bot.</span><span class="sxs-lookup"><span data-stu-id="43677-144">How this is achieved can vary greatly, from individually using different channels and browsers to using a third-party tool, such as [Selenium](https://docs.seleniumhq.org/) to interact through a channel and scrape responses from your bot.</span></span>

### <a name="other-testing"></a><span data-ttu-id="43677-145">Otras pruebas</span><span class="sxs-lookup"><span data-stu-id="43677-145">Other testing</span></span>

<span data-ttu-id="43677-146">Los diferentes tipos de pruebas pueden realizarse junto con los niveles anteriores o desde distintos ángulos, como pruebas de esfuerzo, pruebas de rendimiento o generación de perfiles de la actividad del bot.</span><span class="sxs-lookup"><span data-stu-id="43677-146">Different types of testing can be done in conjunction with the above levels or from different angles, such as stress testing, performance testing, or profiling your bot’s activity.</span></span> <span data-ttu-id="43677-147">Visual Studio proporciona métodos para hacerlo de manera local, así como un [conjunto de herramientas](https://azure.microsoft.com/en-us/solutions/dev-test/) para probar la aplicación, mientras que [Azure Portal](https://portal.azure.com) proporciona información acerca del rendimiento del bot.</span><span class="sxs-lookup"><span data-stu-id="43677-147">Visual studio provides methods to do this locally as well as a [suite of tools](https://azure.microsoft.com/en-us/solutions/dev-test/) for testing your app, and the [Azure portal](https://portal.azure.com) provides insight into how your bot is performing.</span></span>

## <a name="debugging"></a><span data-ttu-id="43677-148">Depuración</span><span class="sxs-lookup"><span data-stu-id="43677-148">Debugging</span></span>

<span data-ttu-id="43677-149">La depuración del bot funciona de forma similar a otras aplicaciones multiproceso, con la capacidad de establecer puntos de interrupción o de usar características como la ventana inmediata.</span><span class="sxs-lookup"><span data-stu-id="43677-149">Debugging your bot works similarly to other multi-threaded apps, with the ability to set breakpoints or use features like the immediate window.</span></span> 

<span data-ttu-id="43677-150">Los bots siguen un paradigma de programación controlado por eventos, que puede ser difícil de racionalizar si no está familiarizado con él.</span><span class="sxs-lookup"><span data-stu-id="43677-150">Bots follow an event driven programming paradigm, which can be hard to rationalize if you’re not familiar with it.</span></span> <span data-ttu-id="43677-151">La idea de que el bot sea sin estado, multiproceso y que se encargue de las llamadas asincrónicas o de espera puede provocar errores inesperados.</span><span class="sxs-lookup"><span data-stu-id="43677-151">The idea of your bot being stateless, multi-threaded, and dealing with async/await calls can result in unexpected bugs.</span></span> <span data-ttu-id="43677-152">Aunque la depuración del bot funciona de forma similar a otras aplicaciones multiproceso, incluiremos algunas sugerencias, herramientas y recursos que le ayudarán.</span><span class="sxs-lookup"><span data-stu-id="43677-152">While debugging your bot works similarly to other multi-threaded apps, we’ll cover some suggestions, tools, and resources to help.</span></span>

<span data-ttu-id="43677-153">**Información sobre las actividades del bot con el emulador**</span><span class="sxs-lookup"><span data-stu-id="43677-153">**Understanding bot activities with the emulator**</span></span>

<span data-ttu-id="43677-154">El bot se ocupa de diferentes tipos de [actividades](bot-builder-basics.md#the-activity-processing-stack), además de la actividad normal de _mensajes_.</span><span class="sxs-lookup"><span data-stu-id="43677-154">Your bot deals with different types of [activities](bot-builder-basics.md#the-activity-processing-stack) besides the normal _message_ activity.</span></span> <span data-ttu-id="43677-155">Mediante el [emulador](../bot-service-debug-emulator.md), le mostraremos cuáles son esas actividades, cuándo se producen y qué información contienen.</span><span class="sxs-lookup"><span data-stu-id="43677-155">Using the [emulator](../bot-service-debug-emulator.md) will show you what those activities are, when they happen, and what information they contain.</span></span> <span data-ttu-id="43677-156">La información sobre esas actividades le ayudará a codificar el bot de forma eficaz y le permitirá comprobar si las actividades que el bot envía y recibe son las esperadas.</span><span class="sxs-lookup"><span data-stu-id="43677-156">Understanding those activities will help you code your bot efficiently and allows you to verify the activities your bot is sending and receiving are what you expect.</span></span>

<span data-ttu-id="43677-157">**Guardado y recuperación de las interacciones del usuario con transcripciones**</span><span class="sxs-lookup"><span data-stu-id="43677-157">**Saving and retrieving user interactions with transcripts**</span></span>

<span data-ttu-id="43677-158">El almacenamiento de transcripciones de blobs de Azure proporciona un recurso especializado en el que puede [almacenar y recuperar transcripciones](bot-builder-howto-v4-storage.md) que contengan interacciones entre los usuarios y el bot.</span><span class="sxs-lookup"><span data-stu-id="43677-158">Azure blob transcript storage provides a specialized resource where you can both [store and retrieve transcripts](bot-builder-howto-v4-storage.md) containing interactions between your users and your bot.</span></span>  

<span data-ttu-id="43677-159">Además, cuando las interacciones de entrada del usuario se han almacenado, puede usar el "_explorador de almacenamiento_" de Azure para ver manualmente los datos contenidos en las transcripciones almacenadas dentro del almacén de transcripciones de blobs.</span><span class="sxs-lookup"><span data-stu-id="43677-159">Additionally, once user input interactions have been stored, you can use Azure's "_storage explorer_" to manually view data contained in transcripts stored within your blob transcript store.</span></span> <span data-ttu-id="43677-160">En el siguiente ejemplo se abre el "_explorador de almacenamiento_" de la configuración de "_mynewtestblobstorage_".</span><span class="sxs-lookup"><span data-stu-id="43677-160">The following example opens "_storage explorer_" from settings for "_mynewtestblobstorage_."</span></span> <span data-ttu-id="43677-161">Para abrir la entrada de usuario guardada, seleccione : contenedor de blob > ChannelId > TranscriptId > ConversationId</span><span class="sxs-lookup"><span data-stu-id="43677-161">To open a saved user input select:    Blob Container > ChannelId > TranscriptId > ConversationId</span></span>

![Examine_stored_transcript_text](./media/examine_transcript_text_in_azure.png)

<span data-ttu-id="43677-163">Abre la entrada de conversación de usuario almacenada en formato JSON.</span><span class="sxs-lookup"><span data-stu-id="43677-163">This opens the stored user conversation input in JSON format.</span></span> <span data-ttu-id="43677-164">La entrada de usuario se conserva junto con la clave "_text:_".</span><span class="sxs-lookup"><span data-stu-id="43677-164">User input is preserved together with the key "_text:_."</span></span>

<span data-ttu-id="43677-165">**Funcionamiento del software intermedio**</span><span class="sxs-lookup"><span data-stu-id="43677-165">**How middleware works**</span></span>

<span data-ttu-id="43677-166">El [software intermedio](bot-builder-concept-middleware.md) puede no ser intuitivo al intentar usarlo por primera vez, especialmente con respecto a la continuación o al cortocircuito de la ejecución.</span><span class="sxs-lookup"><span data-stu-id="43677-166">[Middleware](bot-builder-concept-middleware.md) may not be intuitive when first attempting to use it, particularly regarding the continuation, or short-circuiting, of execution.</span></span> <span data-ttu-id="43677-167">El software intermedio puede ejecutarse en el borde inicial o final de un turno, con una llamada al delegado `next()` que dicte cuándo se pasa la ejecución a la lógica del bot.</span><span class="sxs-lookup"><span data-stu-id="43677-167">Middleware can execute on the leading or trailing edge of a turn, with a call to the `next()` delegate dictating when execution is passed to the bot logic.</span></span> 

<span data-ttu-id="43677-168">Si usa varios fragmentos de software intermedio, el delegado puede pasar la ejecución a otro fragmento de software intermedio si es así cómo está orientada la canalización.</span><span class="sxs-lookup"><span data-stu-id="43677-168">If you are using multiple pieces of middleware the delegate may pass execution to a different piece of middleware if that is how your pipeline is oriented.</span></span> <span data-ttu-id="43677-169">La información sobre [la canalización del software intermedio del bot](bot-builder-concept-middleware.md#the-bot-middleware-pipeline) puede ayudar a entender esta idea.</span><span class="sxs-lookup"><span data-stu-id="43677-169">Details on [the bot middleware pipeline](bot-builder-concept-middleware.md#the-bot-middleware-pipeline) can help make that idea clearer.</span></span>

<span data-ttu-id="43677-170">Si no se llama al delegado `next()`, se denomina [enrutamiento de cortocircuito](bot-builder-concept-middleware.md#short-circuiting).</span><span class="sxs-lookup"><span data-stu-id="43677-170">If the `next()` delegate is not called, that’s referred to as [short circuit routing](bot-builder-concept-middleware.md#short-circuiting).</span></span> <span data-ttu-id="43677-171">Esto sucede cuando el software intermedio satisface la actividad actual y determina que no es necesario pasar la ejecución.</span><span class="sxs-lookup"><span data-stu-id="43677-171">This happens when the middleware satisfies the current activity and determines it’s not necessary to pass execution on.</span></span> 

<span data-ttu-id="43677-172">Comprender cuándo y por qué se produce el cortocircuito del software intermedio ayuda a indicar qué fragmento del software intermedio debe aparecer en primer lugar en la canalización.</span><span class="sxs-lookup"><span data-stu-id="43677-172">Understanding when, and why, middleware short-circuits helps indicate which piece of middleware should come first in your pipeline.</span></span> <span data-ttu-id="43677-173">Además, la comprensión de lo que se puede esperar es especialmente importante para el software intermedio integrado que proporciona el SDK u otros desarrolladores.</span><span class="sxs-lookup"><span data-stu-id="43677-173">Additionally, understanding what to expect is particularly important for built-in middleware provided by the SDK or other developers.</span></span> <span data-ttu-id="43677-174">A algunos usuarios les resulta útil intentar crear su propio software intermedio primero para experimentar un poco antes de profundizar en el software intermedio integrado.</span><span class="sxs-lookup"><span data-stu-id="43677-174">Some find it helpful to try creating your own middleware first to experiment a bit before diving into the built-in middleware.</span></span>

<span data-ttu-id="43677-175">Por ejemplo [QnA Maker](bot-builder-howto-qna.md) está diseñado para controlar ciertas interacciones y cortocircuitar la canalización al mismo tiempo, lo que puede resultar confuso si está aprendiendo a usarlo.</span><span class="sxs-lookup"><span data-stu-id="43677-175">For example [QnA maker](bot-builder-howto-qna.md) is designed to handle certain interactions and short-circuit the pipeline when it does, which can be confusing when first learning how to use it.</span></span>

<span data-ttu-id="43677-176">**Información sobre el estado**</span><span class="sxs-lookup"><span data-stu-id="43677-176">**Understanding state**</span></span>

<span data-ttu-id="43677-177">El seguimiento del estado es una parte importante del bot, especialmente para las tareas complejas.</span><span class="sxs-lookup"><span data-stu-id="43677-177">Keeping track of state is an important part of your bot, particularly for complex tasks.</span></span> <span data-ttu-id="43677-178">En general, el procedimiento recomendado consiste en procesar actividades tan rápidamente como sea posible y permitir que el procesamiento se complete para que se conserve el estado.</span><span class="sxs-lookup"><span data-stu-id="43677-178">In general, best practice is to process activities as quickly as possible and let the processing complete so that state gets persisted.</span></span> <span data-ttu-id="43677-179">Las actividades se pueden enviar al bot casi al mismo tiempo, lo que puede provocar errores muy confusos debido a la arquitectura asincrónica.</span><span class="sxs-lookup"><span data-stu-id="43677-179">Activities can be sent to your bot at nearly the same time, and that can introduce very confusing bugs because of the asynchronous architecture.</span></span>

<span data-ttu-id="43677-180">Lo más importante es asegurarse de conservar el estado de forma que coincida con sus expectativas.</span><span class="sxs-lookup"><span data-stu-id="43677-180">Most importantly, make sure that state is persisting in a way that matches your expectations.</span></span> <span data-ttu-id="43677-181">En función de dónde se encuentre el estado conservado, los emuladores de almacenamiento de [Cosmos DB](https://docs.microsoft.com/en-us/azure/cosmos-db/local-emulator) y [Azure Table Storage](https://docs.microsoft.com/en-us/azure/storage/common/storage-use-emulator) pueden ayudarle a comprobar dicho estado antes de usar el almacenamiento de producción.</span><span class="sxs-lookup"><span data-stu-id="43677-181">Depending on where your persisted state lives, storage emulators for [Cosmos DB](https://docs.microsoft.com/en-us/azure/cosmos-db/local-emulator) and [Azure Table storage](https://docs.microsoft.com/en-us/azure/storage/common/storage-use-emulator) can help you verify that state before using production storage.</span></span>

<span data-ttu-id="43677-182">**Uso de los controladores de actividad**</span><span class="sxs-lookup"><span data-stu-id="43677-182">**How to use activity handlers**</span></span>

<span data-ttu-id="43677-183">Los controladores de actividad pueden introducir otro nivel de complejidad, específicamente que cada actividad se ejecute en un subproceso independiente (o roles de trabajo, dependiendo del lenguaje).</span><span class="sxs-lookup"><span data-stu-id="43677-183">Activity handlers can introduce another layer of complexity, particularly that each activity runs on an independent thread (or web workers, depending on your language).</span></span> <span data-ttu-id="43677-184">En función de lo que hagan los controladores, esto puede causar problemas donde el estado actual no es el esperado.</span><span class="sxs-lookup"><span data-stu-id="43677-184">Depending on what your handlers are doing, this can cause issues where the current state is not what you expect.</span></span>

<span data-ttu-id="43677-185">El estado integrado se escribe al final de un turno, sin embargo, las actividades generadas por dicho turno se ejecutan independientemente de la canalización del turno.</span><span class="sxs-lookup"><span data-stu-id="43677-185">Built in state gets written at the end of a turn, however any activities generated by that turn are executing independently of the turn pipeline.</span></span> <span data-ttu-id="43677-186">Con frecuencia esto no nos afecta, pero, si un controlador de actividad cambia de estado, es necesario que el estado escrito contenga ese cambio.</span><span class="sxs-lookup"><span data-stu-id="43677-186">Often this doesn’t impact us, but if an activity handler changes state we need the state written to contain that change.</span></span> <span data-ttu-id="43677-187">En ese caso, la canalización del turno puede esperar a que la actividad finalice el procesamiento antes de completarse para garantizar que registra el estado correcto del turno.</span><span class="sxs-lookup"><span data-stu-id="43677-187">In that case, the turn pipeline can wait on the activity to finish processing before completing to make sure it records the correct state for that turn.</span></span>

<span data-ttu-id="43677-188">El método de _envío de actividad_ y sus controladores plantean un problema único si quiere producir algo para el usuario, ya que simplemente la llamada al _envío de actividad_ desde ese método provoca una bifurcación infinita de subprocesos.</span><span class="sxs-lookup"><span data-stu-id="43677-188">The _send activity_ method, and its handlers, pose a unique problem if you’d like to output something to the user since simply calling _send activity_ from within that method causes an infinite forking of threads.</span></span> <span data-ttu-id="43677-189">Puede solucionar ese problema de diferentes formas, como anexando el mensaje de depuración a la información saliente o escribiendo en otra ubicación, como la consola o un archivo, para evitar el bloqueo del bot.</span><span class="sxs-lookup"><span data-stu-id="43677-189">There are ways you can work around that problem, such as by appending the debug message to the outgoing information or write out to another location like the console or a file to avoid crashing your bot.</span></span>


## <a name="additional-resources"></a><span data-ttu-id="43677-190">Recursos adicionales</span><span class="sxs-lookup"><span data-stu-id="43677-190">Additional resources</span></span>
* [<span data-ttu-id="43677-191">Depurar en Visual Studio</span><span class="sxs-lookup"><span data-stu-id="43677-191">Debugging in Visual Studio</span></span>](https://docs.microsoft.com/en-us/visualstudio/debugger/index)
* <span data-ttu-id="43677-192">[Depurar, trazar y generar perfiles](https://docs.microsoft.com/en-us/dotnet/framework/debug-trace-profile/) para Bot Framework</span><span class="sxs-lookup"><span data-stu-id="43677-192">[Debugging, Tracing, and Profiling](https://docs.microsoft.com/en-us/dotnet/framework/debug-trace-profile/) for the bot framework</span></span>
* <span data-ttu-id="43677-193">Usar [ConditionalAttribute](https://docs.microsoft.com/en-us/dotnet/api/system.diagnostics.conditionalattribute?view=netcore-2.0) para métodos que no quiere incluir en el código de producción</span><span class="sxs-lookup"><span data-stu-id="43677-193">Use the [ConditionalAttribute](https://docs.microsoft.com/en-us/dotnet/api/system.diagnostics.conditionalattribute?view=netcore-2.0) for methods you don't want to include in production code</span></span> 
* <span data-ttu-id="43677-194">Usar herramientas como [Fiddler](https://www.telerik.com/fiddler) para ver el tráfico de red</span><span class="sxs-lookup"><span data-stu-id="43677-194">Use tools like [Fiddler](https://www.telerik.com/fiddler) to see network traffic</span></span> 
* [<span data-ttu-id="43677-195">Repositorio de herramientas de bot</span><span class="sxs-lookup"><span data-stu-id="43677-195">Bot tools repo</span></span>](https://github.com/Microsoft/botbuilder-tools)
* <span data-ttu-id="43677-196">Los marcos pueden ayudar con las pruebas, como [Moq](https://github.com/moq/moq4)</span><span class="sxs-lookup"><span data-stu-id="43677-196">Frameworks can help with testing, such as [Moq](https://github.com/moq/moq4)</span></span>
