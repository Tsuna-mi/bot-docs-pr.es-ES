---
title: Diálogos en el SDK Bot Builder | Microsoft Docs
description: Se describe qué es un diálogo y cómo funciona en el SDK Bot Builder.
keywords: flujo de conversación, intención de reconocimiento, turno único, varios turnos, conversación de bot, diálogos, avisos, cascadas, conjunto de diálogos
author: johnataylor
ms.author: johtaylo
manager: kamrani
ms.topic: article
ms.prod: bot-framework
ms.date: 9/22/2018
monikerRange: azure-bot-service-4.0
ms.openlocfilehash: 2cf5da32b563c310ee201090c938da9ff410a70c
ms.sourcegitcommit: 3bf3dbb1a440b3d83e58499c6a2ac116fe04b2f6
ms.translationtype: HT
ms.contentlocale: es-ES
ms.lasthandoff: 09/23/2018
ms.locfileid: "46708864"
---
# <a name="dialogs-library"></a><span data-ttu-id="388b6-104">Biblioteca de diálogos</span><span class="sxs-lookup"><span data-stu-id="388b6-104">Dialogs library</span></span>

[!INCLUDE [pre-release-label](../includes/pre-release-label.md)]

<span data-ttu-id="388b6-105">El concepto central del SDK para administrar las conversaciones es la idea de diálogo.</span><span class="sxs-lookup"><span data-stu-id="388b6-105">The central concept in the SDK to manage conversations is the idea of a Dialog.</span></span> <span data-ttu-id="388b6-106">Los objetos de diálogo procesan las actividades de entrada y generan las respuestas de salida.</span><span class="sxs-lookup"><span data-stu-id="388b6-106">Dialog objects process inbound Activities and generate outbound responses.</span></span> <span data-ttu-id="388b6-107">La lógica de negocios del bot se ejecuta directa o indirectamente dentro de clases de diálogo.</span><span class="sxs-lookup"><span data-stu-id="388b6-107">The business logic of the bot runs either directly or indirectly within Dialog classes.</span></span>

<span data-ttu-id="388b6-108">En tiempo de ejecución, las instancias de diálogo se organizan en una pila.</span><span class="sxs-lookup"><span data-stu-id="388b6-108">At runtime, Dialog instances are arranged in a stack.</span></span> <span data-ttu-id="388b6-109">El diálogo en la parte superior de la pila se conoce como ActiveDialog.</span><span class="sxs-lookup"><span data-stu-id="388b6-109">The Dialog on the top of the stack is referred to as the ActiveDialog.</span></span> <span data-ttu-id="388b6-110">El diálogo activo actual procesa la actividad de entrada.</span><span class="sxs-lookup"><span data-stu-id="388b6-110">The current active Dialog processes the inbound Activity.</span></span> <span data-ttu-id="388b6-111">Entre cada turno de la conversación (que no está vinculado al tiempo y puede durar varios días), la pila se guarda.</span><span class="sxs-lookup"><span data-stu-id="388b6-111">Between each turn of the conversation (which is not time-bound and maybe over several days), the stack is persisted.</span></span> 

<span data-ttu-id="388b6-112">Un diálogo implementa tres funciones principales:</span><span class="sxs-lookup"><span data-stu-id="388b6-112">A Dialog implements three main functions:</span></span>
- <span data-ttu-id="388b6-113">BeginDialog</span><span class="sxs-lookup"><span data-stu-id="388b6-113">BeginDialog</span></span>
- <span data-ttu-id="388b6-114">ContinueDialog</span><span class="sxs-lookup"><span data-stu-id="388b6-114">ContinueDialog</span></span>
- <span data-ttu-id="388b6-115">ResumeDialog</span><span class="sxs-lookup"><span data-stu-id="388b6-115">ResumeDialog</span></span>

<span data-ttu-id="388b6-116">En tiempo de ejecución, los diálogos y la clase DialogContext funcionan juntos para elegir el diálogo adecuado para gestionar la actividad.</span><span class="sxs-lookup"><span data-stu-id="388b6-116">At runtime, Dialogs and DialogContext class work together to choose the appropriate Dialog to handle the activity.</span></span> <span data-ttu-id="388b6-117">La clase DialogContext enlaza la pila de diálogos guardada, la actividad de entrada y la clase DialogSet.</span><span class="sxs-lookup"><span data-stu-id="388b6-117">The DialogContext class ties the persisted Dialog stack, the inbound Activity, and the DialogSet class.</span></span> <span data-ttu-id="388b6-118">La clase DialogSet contiene diálogos que el bot puede llamar.</span><span class="sxs-lookup"><span data-stu-id="388b6-118">A DialogSet contains dialogs that the bot can call.</span></span>

<span data-ttu-id="388b6-119">La interfaz de DialogContext refleja el concepto subyacente del comienzo y la continuación del diálogo.</span><span class="sxs-lookup"><span data-stu-id="388b6-119">The DialogContext's interface reflects the underlying notion of Dialog’s begin and continue.</span></span> <span data-ttu-id="388b6-120">El patrón general para la aplicación es llamar siempre primero a ContinueDialog.</span><span class="sxs-lookup"><span data-stu-id="388b6-120">The general pattern for the application is always to call ContinueDialog first.</span></span> <span data-ttu-id="388b6-121">Si no hay ninguna pila y, por tanto, no hay ningún diálogo ActiveDialog, la aplicación debe comenzar el diálogo que elija llamando a BeginDialog en DialogContext.</span><span class="sxs-lookup"><span data-stu-id="388b6-121">If there is no stack and therefore no ActiveDialog, the application should begin the Dialog it chooses by calling BeginDialog on the DialogContext.</span></span> <span data-ttu-id="388b6-122">De esta manera, la entrada de diálogo correspondiente de DialogSet se inserta en la pila (técnicamente es el identificador del diálogo que se agrega a la pila) y se delega entonces una llamada en BeginDialog en el objeto de diálogo específico.</span><span class="sxs-lookup"><span data-stu-id="388b6-122">This will cause the corresponding Dialog entry from the DialogSet to be pushed onto the stack (technically it’s the Dialog’s id that is added to the stack) and it will then delegate a call to BeginDialog on the specific Dialog object.</span></span> <span data-ttu-id="388b6-123">Si hubiera habido un diálogo ActiveDialog, simplemente se habría delegado la llamada en la función ContinueDialog de ese diálogo en el procesamiento y se le habría dado a este las propiedades guardadas asociadas.</span><span class="sxs-lookup"><span data-stu-id="388b6-123">If there had been an ActiveDialog, it would have simply delegated the call to that Dialog’s ContinueDialog, in the processing giving that Dialog any associated persisted properties.</span></span>

<span data-ttu-id="388b6-124">Tenga en cuenta que una **función BeginDialog del diálogo** es código de inicialización y toma las propiedades de inicialización (llamadas "opciones" en el código) y que una **función ContinueDialog del diálogo** es el código que se ejecuta para continuar con la ejecución a la llegada de una actividad que sigue a la persistencia.</span><span class="sxs-lookup"><span data-stu-id="388b6-124">Notice that a **Dialog’s BeginDialog** is initialization code and takes initialization properties (called “options” in the code) and a **Dialog’s ContinueDialog** is the code that is run to continue execution on the arrival of an Activity following persistence.</span></span> <span data-ttu-id="388b6-125">Por ejemplo, imagine un diálogo que le hace una pregunta al usuario; la pregunta se haría en BeginDialog y la respuesta se esperaría en ContinueDialog.</span><span class="sxs-lookup"><span data-stu-id="388b6-125">For example, imagine a Dialog that asks the user a question, the question would be asked in the BeginDialog and the answer expected in the ContinueDialog.</span></span>

<span data-ttu-id="388b6-126">Para permitir el anidamiento de diálogos (donde un diálogo tiene diálogos secundarios), hay un tipo adicional de continuación, que se conoce como reanudación.</span><span class="sxs-lookup"><span data-stu-id="388b6-126">To support nesting of Dialogs (where a dialog has child dialog) there is an additional type of continuation; this is called resumption.</span></span> <span data-ttu-id="388b6-127">DialogContext llamará al método ResumeDialog en un diálogo principal cuando finalice un diálogo secundario.</span><span class="sxs-lookup"><span data-stu-id="388b6-127">The DialogContext will call the ResumeDialog method on a parent Dialog when a child Dialog completes.</span></span>

<span data-ttu-id="388b6-128">Los avisos y las cascadas son ambos ejemplos concretos de diálogos que proporciona el SDK.</span><span class="sxs-lookup"><span data-stu-id="388b6-128">Prompts and Waterfalls are both concrete examples of Dialogs provided by the SDK.</span></span> <span data-ttu-id="388b6-129">Son muchos los escenarios que se crean mediante la composición de estas abstracciones; pero, en segundo plano, la lógica ejecutada es siempre el mismo comienzo, es decir, el patrón de continuación y reanudación aquí descrito.</span><span class="sxs-lookup"><span data-stu-id="388b6-129">Many scenarios are built by composing these abstractions, but under the covers, the logic executed is always the same begin, i.e., the continue and resume pattern described here.</span></span> <span data-ttu-id="388b6-130">La implementación de una clase de diálogo desde el principio es un tema relativamente avanzado, pero se incluye una muestra en los [ejemplos](https://github.com/Microsoft/BotBuilder-samples).</span><span class="sxs-lookup"><span data-stu-id="388b6-130">Implementing a Dialog class from scratch is a relatively advanced topic, but an example is included in the [samples](https://github.com/Microsoft/BotBuilder-samples).</span></span>

<span data-ttu-id="388b6-131">La biblioteca **Dialog** del SDK Bot Builder incluye características integradas como _avisos_, _diálogos de cascada_ y _diálogos de componentes_ para ayudarle a administrar la conversación del bot.</span><span class="sxs-lookup"><span data-stu-id="388b6-131">The **Dialog** library in the Bot Builder SDK includes built-in features such as _prompts_, _waterfall dialogs_, and _component dialogs_ to help you manage your bot's conversation.</span></span> <span data-ttu-id="388b6-132">Puede usar avisos para pedir a los usuarios diferentes tipos de información, una cascada para combinar varios pasos en una secuencia y diálogos de componentes para empaquetar la lógica de diálogo en clases independientes que luego se pueden integrar en otros bots.</span><span class="sxs-lookup"><span data-stu-id="388b6-132">You can use prompts to ask users for different types of information, a waterfall to combine multiple steps in a sequence, and component dialogs to package your dialog logic into separate classes that can then be integrated into other bots.</span></span>
## <a name="waterfall-dialogs-and-prompts"></a><span data-ttu-id="388b6-133">Diálogos y avisos de cascada</span><span class="sxs-lookup"><span data-stu-id="388b6-133">Waterfall Dialogs and Prompts</span></span>

<span data-ttu-id="388b6-134">La biblioteca **Dialog** incluye un conjunto de tipos de avisos que puede usar para recopilar diversos tipos de entradas de usuario.</span><span class="sxs-lookup"><span data-stu-id="388b6-134">The **Dialog** library comes with a set of prompt types you can use to collect various types of user input.</span></span> <span data-ttu-id="388b6-135">Por ejemplo, para pedir a un usuario la entrada de texto, puede usar **TextPrompt**; para pedir al usuario un número, puede usar **NumberPrompt**; y para pedir una fecha y una hora, puede usar **DateTimePrompt**.</span><span class="sxs-lookup"><span data-stu-id="388b6-135">For example, to ask a user for text input, you can use the **TextPrompt**; to ask a user for a number, you can use the **NumberPrompt**; to ask for a date and time, you can use the **DateTimePrompt**.</span></span> <span data-ttu-id="388b6-136">Loa avisos son un tipo especial de diálogo.</span><span class="sxs-lookup"><span data-stu-id="388b6-136">Prompts are a particular type of dialog.</span></span> <span data-ttu-id="388b6-137">Para usar un aviso de un diálogo de cascada, agregue la cascada y el aviso al mismo conjunto de diálogos.</span><span class="sxs-lookup"><span data-stu-id="388b6-137">To use a prompt from a waterfall dialog, add both the waterfall and the prompt to the same dialog set.</span></span> 

<span data-ttu-id="388b6-138">Dada la naturaleza de la interacción solicitud-respuesta, para implementar un aviso se requieren al menos dos pasos en un diálogo de cascada: uno para enviar el aviso y otro para capturar y procesar la respuesta.</span><span class="sxs-lookup"><span data-stu-id="388b6-138">Because of the nature of the prompt-response interaction, implementing a prompt requires at least two steps in a waterfall dialog - one to send the prompt, and a second to capture and process the response.</span></span>  <span data-ttu-id="388b6-139">Si tiene un aviso adicional, en ocasiones puede combinar estos pasos mediante una única función para procesar primero la respuesta del usuario y luego iniciar el siguiente aviso.</span><span class="sxs-lookup"><span data-stu-id="388b6-139">If you have an additional prompt, you can sometimes combine these by using a single function to first process the user's response and then start the next prompt.</span></span>

<span data-ttu-id="388b6-140">`WaterfallDialog` es una implementación específica de un diálogo que se usa para recopilar información del usuario o guiar al usuario por una serie de tareas.</span><span class="sxs-lookup"><span data-stu-id="388b6-140">A `WaterfallDialog` is a specific implementation of a dialog that is used to collect information from the user or guide the user through a series of tasks.</span></span> <span data-ttu-id="388b6-141">Las tareas se implementan como una matriz de funciones, donde el resultado de la primera función se pasa como argumento a la función siguiente y así sucesivamente.</span><span class="sxs-lookup"><span data-stu-id="388b6-141">The tasks are implemented as an array of functions where the result of the first function is passed as an argument into the next function, and so on.</span></span> <span data-ttu-id="388b6-142">Cada función representa normalmente un paso del proceso general.</span><span class="sxs-lookup"><span data-stu-id="388b6-142">Each function typically represents one step in the overall process.</span></span> <span data-ttu-id="388b6-143">En cada paso, el bot pide al usuario que intervenga, espera una respuesta y, a continuación, pasa el resultado al paso siguiente.</span><span class="sxs-lookup"><span data-stu-id="388b6-143">At each step, the bot prompts the user for input, waits for a response, and then passes the results to the next step.</span></span> 

<span data-ttu-id="388b6-144">Los avisos y las cascadas son ambos diálogos, como se muestra en la siguiente jerarquía de clases.</span><span class="sxs-lookup"><span data-stu-id="388b6-144">Prompts and Waterfall are both Dialogs, as shown in the following class hierarchy.</span></span> 

![clases de diálogo](media/bot-builder-dialog-classes.png)

<span data-ttu-id="388b6-146">Un diálogo de cascada se compone de una secuencia de pasos de cascada.</span><span class="sxs-lookup"><span data-stu-id="388b6-146">A waterfall dialog is composed of a sequence of waterfall steps.</span></span> <span data-ttu-id="388b6-147">Cada paso es un delegado asincrónico que toma un parámetro de _contexto de paso de cascada_ (`step`).</span><span class="sxs-lookup"><span data-stu-id="388b6-147">Each step is an asynchronous delegate that takes a _waterfall step context_ (`step`) parameter.</span></span> <span data-ttu-id="388b6-148">El patrón es que lo último que se haga en un paso de la cascada sea comenzar un diálogo secundario (normalmente un aviso) o finalizar la cascada propiamente dicha.</span><span class="sxs-lookup"><span data-stu-id="388b6-148">The pattern is that the last thing done in a waterfall step is to either begin a child dialog (typically a prompt) or end the waterfall itself.</span></span> <span data-ttu-id="388b6-149">En el diagrama siguiente se muestra una secuencia de pasos de cascada y las operaciones de la pila que tienen lugar.</span><span class="sxs-lookup"><span data-stu-id="388b6-149">The following diagram shows a sequence of waterfall steps and the stack operations that take place.</span></span>

![Concepto de diálogo](media/bot-builder-dialog-concept.png)

<span data-ttu-id="388b6-151">Puede controlar un valor devuelto por un diálogo, bien dentro de un paso de la cascada de un diálogo o desde el controlador de turnos del bot.</span><span class="sxs-lookup"><span data-stu-id="388b6-151">You can handle a return value from a dialog either within a waterfall step in a dialog or from your bot's on turn handler.</span></span>
<span data-ttu-id="388b6-152">Dentro de un paso de la cascada, el diálogo proporciona el valor devuelto en la propiedad _result_ del contexto del paso.</span><span class="sxs-lookup"><span data-stu-id="388b6-152">Within a waterfall step, the dialog provides the return value in the waterfall step context's _result_ property.</span></span>
<span data-ttu-id="388b6-153">Por lo general, solo será necesario comprobar el estado del resultado de turnos del diálogo desde la lógica de turnos del bot.</span><span class="sxs-lookup"><span data-stu-id="388b6-153">You generally only need to check the status of the dialog turn result from your bot's turn logic.</span></span>

## <a name="repeating-a-dialog"></a><span data-ttu-id="388b6-154">Repetición de un diálogo</span><span class="sxs-lookup"><span data-stu-id="388b6-154">Repeating a dialog</span></span>

<span data-ttu-id="388b6-155">Para repetir un diálogo, use el método *replace dialog*.</span><span class="sxs-lookup"><span data-stu-id="388b6-155">To repeat a dialog, use the *replace dialog* method.</span></span> <span data-ttu-id="388b6-156">El método *replace dialog* del contexto de diálogo retira el diálogo actual de la pila, inserta el diálogo sustituto en la parte superior de la pila y comienza dicho diálogo.</span><span class="sxs-lookup"><span data-stu-id="388b6-156">The dialog context's *replace dialog* method will pop the current dialog off the stack and push the replacing dialog onto the top of the stack and begin that dialog.</span></span> <span data-ttu-id="388b6-157">Puede usar este método para crear un bucle al reemplazar un diálogo por sí mismo.</span><span class="sxs-lookup"><span data-stu-id="388b6-157">You can use this method to create a loop by replacing a dialog with itself.</span></span> <span data-ttu-id="388b6-158">Tenga en cuenta que si tiene que conservar el estado interno del diálogo actual, deberá pasar información a la nueva instancia del diálogo en la llamada al método _replace dialog_ y, luego, inicializar el diálogo de la manera adecuada.</span><span class="sxs-lookup"><span data-stu-id="388b6-158">Note that if you need to persist the internal state for the current dialog, you will need to pass information to the new instance of the dialog in the call to the _replace dialog_ method, and then initialize the dialog appropriately.</span></span> <span data-ttu-id="388b6-159">Para acceder a las opciones pasadas al nuevo diálogo se puede usar la propiedad _options_ del contexto en cualquier paso del diálogo.</span><span class="sxs-lookup"><span data-stu-id="388b6-159">The options passed into the new dialog can be accessed via the step context's _options_ property in any step of the dialog.</span></span> <span data-ttu-id="388b6-160">Esta es una excelente manera de controlar un flujo de conversación complejo o de administrar los menús.</span><span class="sxs-lookup"><span data-stu-id="388b6-160">This is a great way to handle a complex conversation flow or to manage menus.</span></span>

## <a name="branch-a-conversation"></a><span data-ttu-id="388b6-161">Bifurcación de una conversación</span><span class="sxs-lookup"><span data-stu-id="388b6-161">Branch a conversation</span></span>

<span data-ttu-id="388b6-162">El contexto del diálogo mantiene una _pila de diálogos_ y, para cada diálogo de la pila, lleva el seguimiento de cuál es el siguiente paso.</span><span class="sxs-lookup"><span data-stu-id="388b6-162">The dialog context maintains a _dialog stack_ and for each dialog on the stack, tracks which step is next.</span></span> <span data-ttu-id="388b6-163">Su método _begin dialog_ inserta un diálogo en la parte superior de la pila y su método _end dialog_ retira el diálogo superior de la pila.</span><span class="sxs-lookup"><span data-stu-id="388b6-163">Its _begin dialog_ method pushes a dialog onto the top of the stack, and its _end dialog_ method pops the top dialog off the stack.</span></span>

<span data-ttu-id="388b6-164">Para iniciar un nuevo diálogo dentro del mismo conjunto de diálogos, un diálogo puede llamar al método _begin dialog_ del contexto del diálogo o proporcionar el identificador del nuevo diálogo, lo que convierte a este en el diálogo actualmente activo.</span><span class="sxs-lookup"><span data-stu-id="388b6-164">A dialog can start a new dialog within the same dialog set by calling the dialog context's _begin dialog_ method and providing the ID of the new dialog, which then makes the new dialog the currently active dialog.</span></span> <span data-ttu-id="388b6-165">El diálogo original está todavía en la pila, pero las llamadas al método _continue_ del contexto del diálogo solo se envían al diálogo que está arriba de la pila, el _diálogo activo_.</span><span class="sxs-lookup"><span data-stu-id="388b6-165">The original dialog is still on the stack, but calls to the dialog context's _continue dialog_ method are only sent to the dialog that is on top of the stack, the _active dialog_.</span></span> <span data-ttu-id="388b6-166">Cuando un diálogo se retira de la pila, el contexto del diálogo se reanuda con el siguiente paso de la cascada en la pila donde se dejó el diálogo original.</span><span class="sxs-lookup"><span data-stu-id="388b6-166">When a dialog is popped off the stack, the dialog context will resume with the next step of the waterfall on the stack where it left off of the original dialog.</span></span>

<span data-ttu-id="388b6-167">Por lo tanto, puede crear una bifurcación dentro del flujo de conversación mediante la inclusión de un paso en un diálogo que puede elegir condicionalmente un diálogo para iniciar de un conjunto de diálogos disponibles.</span><span class="sxs-lookup"><span data-stu-id="388b6-167">Therefore, you can create a branch within your conversation flow by including a step in one dialog that can conditionally choose a dialog to start out of a set of available dialogs.</span></span>

## <a name="component-dialog"></a><span data-ttu-id="388b6-168">Diálogo de componente</span><span class="sxs-lookup"><span data-stu-id="388b6-168">Component dialog</span></span>
<span data-ttu-id="388b6-169">En ocasiones, querrá escribir un diálogo reutilizable para usar en distintos escenarios.</span><span class="sxs-lookup"><span data-stu-id="388b6-169">Sometimes you want to write a reusable Dialog that you want to use in different scenarios.</span></span> <span data-ttu-id="388b6-170">Un ejemplo podría ser un diálogo de dirección que pide al usuario que proporcione valores para calle, ciudad y código postal.</span><span class="sxs-lookup"><span data-stu-id="388b6-170">An example might be an address Dialog that asks the user to provide values for street, city and zip code.</span></span> 

<span data-ttu-id="388b6-171">ComponentDialog proporciona un nivel de aislamiento porque tiene una clase DialogSet independiente.</span><span class="sxs-lookup"><span data-stu-id="388b6-171">The ComponentDialog provides a level of isolation because it has a separate DialogSet .</span></span> <span data-ttu-id="388b6-172">Al tener una clase DialogSet independiente, se evitan colisiones de nombres con el elemento principal que contiene el diálogo y se crea un entorno propio de ejecución de diálogos interno independiente (al crearse su propio DialogContext), al que se distribuye la actividad.</span><span class="sxs-lookup"><span data-stu-id="388b6-172">By having a separate DialogSet, it avoids name collisions with the parent containing Dialog, and it creates its own independent internal Dialog runtime (by creating its own DialogContext) and dispatches the Activity to that.</span></span> <span data-ttu-id="388b6-173">Esta distribución secundaria significa que ha tenido la oportunidad de interceptar la actividad.</span><span class="sxs-lookup"><span data-stu-id="388b6-173">This secondary dispatch means that it has had an opportunity to intercept the Activity.</span></span> <span data-ttu-id="388b6-174">Esto puede ser muy útil si quiere implementar características como "ayuda" y "cancelar".</span><span class="sxs-lookup"><span data-stu-id="388b6-174">This can be very useful if you want to implement features such as “help” and “cancel.”</span></span>  <span data-ttu-id="388b6-175">Consulte el ejemplo de plantilla de bot de empresa.</span><span class="sxs-lookup"><span data-stu-id="388b6-175">See Enterprise Bot Template sample.</span></span> 

## <a name="next-steps"></a><span data-ttu-id="388b6-176">Pasos siguientes</span><span class="sxs-lookup"><span data-stu-id="388b6-176">Next steps</span></span>

> [!div class="nextstepaction"]
> [<span data-ttu-id="388b6-177">Uso de la biblioteca de diálogos para recopilar datos de entrada del usuario</span><span class="sxs-lookup"><span data-stu-id="388b6-177">Use dialog library to gather user input</span></span>](bot-builder-prompts.md)
